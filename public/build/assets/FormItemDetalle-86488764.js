import{r as t,a as v,j as e}from"./app-5820f2fc.js";import{I as d}from"./inputnumber.esm-c4ec8b34.js";import{I as Me,S as ye}from"./slider.esm-1787265d.js";import{D as T}from"./divider.esm-5ccc7119.js";import{I as le}from"./inputtext.esm-cd831930.js";import{D as R}from"./dropdown.esm-e42895fb.js";import{B as ie}from"./button.esm-a7803143.js";import{T as Fe}from"./toast.esm-a8d05a6e.js";import{P as De}from"./progressspinner.esm-d7ca519a.js";import{E as _e}from"./editor.esm-7abdf248.js";import{B as ne}from"./badge.esm-86947190.js";import"./iconbase.esm-a7b8798a.js";import"./index.esm-c672f095.js";import"./ripple.esm-ee4508bf.js";import"./tooltip.esm-de61fec8.js";import"./overlayservice.esm-8c1f21ea.js";import"./index.esm-d7c3364d.js";import"./index.esm-2acefc1d.js";import"./csstransition.esm-2ed9e3b3.js";import"./virtualscroller.esm-34745144.js";import"./index.esm-4089079a.js";const Ze=({cotizacion:M,detalle:n=null,modalVisible:W,recargarListado:we,detalleItem:re})=>{const[r,y]=t.useState(0),c=t.useRef(null),[F,S]=t.useState(!1),[ce,q]=t.useState(!1),[de,G]=t.useState("Registrar"),[H,J]=t.useState(null),[D,ue]=t.useState(null),[u,_]=t.useState("todo");t.useEffect(()=>{M&&ue(M)},[M]),t.useEffect(()=>{(async()=>{try{n==null?(_("todo"),await se()):n.es_tomo===1?(_("tomo"),await oe(n.id),J(n.id),G("Actualizar")):n.es_tomo===0&&(_("detalle"),await se(),await oe(n.id),J(n.id),G("Actualizar"))}catch(o){console.error("Error en fetchData:",o)}})()},[n]);const[me,pe]=t.useState([]),[m,K]=t.useState(0);t.useEffect(()=>{m==2&&je()},[m]);const[he,Ie]=t.useState([{name:"Ninguno",value:0},{name:"Captura Tomo",value:1},{name:"Listar Tomos",value:2}]),[w,Q]=t.useState(""),[I,fe]=t.useState(null),[xe,be]=t.useState([]),[$,X]=t.useState(""),[k,Y]=t.useState(null),[p,Z]=t.useState(1),[x,ee]=t.useState(0),[h,C]=t.useState(0),[b,E]=t.useState(0);t.useEffect(()=>{C(x)},[x]),t.useEffect(()=>{const a=p*h;E(a)},[p,h]);const[O,U]=t.useState(null),[A,z]=t.useState(null);t.useEffect(()=>{const a=Math.round(h*(1+r/100));U(parseFloat(a));const o=Math.round(f*(1+r/100));z(parseFloat(o))},[r]),t.useEffect(()=>{U(null),z(null)},[]);const[j,ae]=t.useState(null),[f,N]=t.useState(null),[g,P]=t.useState(0);t.useEffect(()=>{N(j)},[j]),t.useEffect(()=>{const a=p*f;P(a)},[p,f]);const[L,V]=t.useState(0);t.useEffect(()=>{const a=b+g;V(a)},[b,g]);const[B,te]=t.useState(null),je=async()=>{await v.get(`${route("cotizacion.list.tomos",{identy:D})}`).then(a=>{const{data:o,status:l}=a;if(l==200){const s=o.map(i=>({id:i.id,name:i.PDA+" - "+i.descripcion}));be(s)}})},se=async()=>{await v.get(`${route("catalogo.list.unidadesmedidas")}`).then(a=>{const{data:o,status:l}=a;if(l==200){const s=o.map(i=>({value:i.id,name:i.nombre+" - "+i.abreviatura}));pe(s)}})},oe=async a=>{const o=a;await v.get(`${route("cotizacion.captura.item.detalle",{id:o})}`).then(l=>{const{data:s,status:i}=l;i==200&&(s.es_tomo==1?(K(1),Q(s.descripcion),setTimeout(()=>{q(!0)},600)):(q(!1),X(s.descripcion),Z(s.costo_material_cantidad),ee(s.costo_material_unitario_sugerido),ae(s.costo_mano_obra_unitario_sugerido),te(s.comentarios_extras),setTimeout(()=>{Y(s.cat_unidad_medida_id),C(s.costo_material_unitario),N(s.costo_mano_obra_unitario)},600),setTimeout(()=>{E(s.costo_material_subtotal),P(s.costo_mano_obra_subtotal),V(s.obra_material_subtotal)},1e3)))})},ge=async()=>{S(!0);const a={identyCotizacion:D,perteneceTomo:m,capturaTomo:w,seleccionTomo:I,descripcionMaterial:$,seleccionUnidadMedida:k,cantidadMaterial:p,costoMaterialSugerido:x,costoMaterialFinal:h,subTotalMaterial:b,costoManoObraSugerido:j,costoManoObraFinal:f,subTotalManoObra:g,subTotalMateObraTotal:L,citaComentario:B};await v.post(`${route("cotizacion.guardad.captura")}`,a).then(o=>{const{status:l,data:s}=o;l==201&&c.current.show({severity:"info",summary:"Info",detail:`${s.success}`})}).catch(o=>{var i;const{response:l,status:s}=o;if(s==500){const Te=((i=l==null?void 0:l.data)==null?void 0:i.error)||"";c.current.show({severity:"error",summary:"Error",detail:`No se pudo guardar la cotización.${Te}`,life:9e3})}}).finally(()=>{setTimeout(()=>{W(),setTimeout(()=>{c.current.show({severity:"info",summary:"Info",detail:"Datos guardados correctamente"}),S(!1)},1e3)},2e3)})},ve=async()=>{S(!0);const a={identyDetallle:H,identyCotizacion:D,perteneceTomo:m,capturaTomo:w,seleccionTomo:I,descripcionMaterial:$,seleccionUnidadMedida:k,cantidadMaterial:p,costoMaterialSugerido:x,costoMaterialFinal:h,subTotalMaterial:b,costoManoObraSugerido:j,costoManoObraFinal:f,subTotalManoObra:g,subTotalMateObraTotal:L,citaComentario:B};try{await v.post(`${route("cotizacion.captura.item.actualiza")}`,a).then(o=>{const{status:l,data:s}=o;l==201&&c.current.show({severity:"info",summary:"Info",detail:"Datos actualizados correctamente"})}).finally(()=>{setTimeout(()=>{W(),setTimeout(()=>{c.current.show({severity:"info",summary:"Info",detail:"Datos guardados correctamente"}),S(!1)},1e3)},600)})}catch{setLoader(!1),c.current.show}},Se=a=>{a.preventDefault(),u=="todo"&&ge(),(u=="tomo"||u=="detalle")&&ve()},Ce=e.jsx("div",{className:"flex justify-content-end",children:e.jsxs("div",{className:"max-w-full",children:[e.jsx("label",{htmlFor:"percent",className:"font-bold block mb-2",children:"Aumento Costos %"}),e.jsx(le,{value:r,onChange:a=>y(a.target.value),className:"w-full p-inputtext-sm",readOnly:!0}),e.jsx(ye,{value:r,onChange:a=>y(a.value),className:"w-full"})]})}),Ne=()=>{C(O),N(A),y(0),setTimeout(()=>{c.current.show({severity:"info",summary:"Info",detail:`Se implemento el porentaje ${r}. Actualiza para guardar los cambios necesarios`}),U(null),z(null)},1e3)};return e.jsxs("div",{className:"card",children:[e.jsxs("form",{action:"",method:"post",onSubmit:Se,children:[(u==="todo"||u==="tomo")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{class:"formgrid grid",children:[e.jsxs("div",{class:"field col-4",children:[e.jsx("label",{htmlFor:"defineTomo",className:"font-bold block mb-2",children:"Definición de Tomo"}),e.jsx(R,{value:m,onChange:a=>{K(a.value)},disabled:ce,options:he,optionLabel:"name",placeholder:"Seleccione",className:"w-full"})]}),e.jsxs("div",{class:"field col-8",children:[m==1&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"mile",className:"font-bold block mb-2",children:"Captura un Tomo"}),e.jsx(le,{value:w,onChange:a=>Q(a.target.value),className:"w-full"})]}),m==2&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"selectTomo",className:"font-bold block mb-2",children:"Selecciona un Tomo"}),e.jsx(R,{value:I,onChange:a=>fe(a.value),options:xe,optionLabel:"name",placeholder:"Seleccione",className:"w-full"})]})]})]}),e.jsx(T,{})]}),(u==="todo"||u==="detalle")&&e.jsxs(e.Fragment,{children:[e.jsx("h5",{children:"Costo de Materiales"}),H!==null&&e.jsx("div",{class:"col-12",children:Ce}),e.jsx("div",{class:"formgrid grid",children:e.jsxs("div",{class:"field col-12",children:[e.jsx("label",{htmlFor:"percent",className:"font-bold block mb-2",children:"Descripción"}),e.jsx(_e,{value:$,onTextChange:a=>X(a.htmlValue),style:{height:"160px"}})]})}),e.jsxs("div",{class:"formgrid grid",children:[e.jsxs("div",{class:"field col-4",children:[e.jsx("label",{htmlFor:"percent",className:"font-bold block mb-2",children:"Unidad"}),e.jsx(R,{value:k,onChange:a=>Y(a.value),options:me,optionLabel:"name",placeholder:"Selecciona",className:"w-full"})]}),e.jsxs("div",{class:"field col-4",children:[e.jsx("label",{htmlFor:"cantidad",className:"font-bold block mb-2",children:"Catidad"}),e.jsx(d,{inputId:"cantidad",value:p,min:0,maxFractionDigits:0,onValueChange:a=>Z(a.value),placeholder:"Cantidad"})]}),e.jsxs("div",{class:"field col-4",children:[e.jsx("label",{htmlFor:"CostoSugerido",className:"font-bold block mb-2",children:"Costo Unitario Sugerido"}),e.jsxs("div",{className:"p-inputgroup flex-1",children:[e.jsx("span",{className:"p-inputgroup-addon",children:"$"}),e.jsx(d,{inputId:"cantidad",value:x,min:0,maxFractionDigits:0,onValueChange:a=>ee(a.value),placeholder:"Consto Unitario Sugerido"})]})]}),e.jsxs("div",{class:"field col-4",children:[e.jsx("label",{htmlFor:"percent",className:"font-bold block mb-2",children:"Costo Unitario"}),O&&e.jsx("div",{className:"flex justify-content-end",children:e.jsx(ne,{value:`$ ${O}`})}),e.jsxs("div",{className:"p-inputgroup flex-1",children:[e.jsx("span",{className:"p-inputgroup-addon",children:"$"}),e.jsx(d,{inputId:"cantidad",value:h,min:0,maxFractionDigits:0,onValueChange:a=>C(a.value),placeholder:"Consto Unitario"})]})]}),e.jsxs("div",{class:"field col-4",children:[e.jsx("label",{htmlFor:"percent",className:"font-bold block mb-2",children:"Subtotal"}),e.jsxs("div",{className:"p-inputgroup flex-1",children:[e.jsx("span",{className:"p-inputgroup-addon",children:"$"}),e.jsx(d,{inputId:"cantidad",disabled:!0,value:b,onValueChange:a=>E(a.value),placeholder:"Consto Unitario"})]})]})]}),re.es_mano_obra==1&&e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsx("h5",{children:"Costo de Mano de Obra"}),e.jsxs("div",{class:"formgrid grid",children:[e.jsxs("div",{class:"field col-4",children:[e.jsx("label",{htmlFor:"costUnitSugeridoManoObra",className:"font-bold block mb-2",children:"Costo Unitario Sugerido"}),e.jsxs("div",{className:"p-inputgroup flex-1",children:[e.jsx("span",{className:"p-inputgroup-addon",children:"$"}),e.jsx(d,{inputId:"cantidad",value:j,min:0,maxFractionDigits:0,onValueChange:a=>ae(a.value),placeholder:"Consto Unitario"})]})]}),e.jsxs("div",{class:"field col-4",children:[e.jsx("label",{htmlFor:"percent",className:"font-bold block mb-2",children:"Costo Unitario"}),A&&e.jsx("div",{className:"flex justify-content-center",children:e.jsx(ne,{value:`$ ${A}`})}),e.jsxs("div",{className:"p-inputgroup flex-1",children:[e.jsx("span",{className:"p-inputgroup-addon",children:"$"}),e.jsx(d,{inputId:"cantidad",value:f,min:0,maxFractionDigits:0,onValueChange:a=>N(a.value),placeholder:"Consto Unitario"})]})]}),e.jsxs("div",{class:"field col-4",children:[e.jsx("label",{htmlFor:"percent",className:"font-bold block mb-2",children:"Subtotal"}),e.jsxs("div",{className:"p-inputgroup flex-1",children:[e.jsx("span",{className:"p-inputgroup-addon",children:"$"}),e.jsx(d,{disabled:!0,inputId:"cantidad",value:g,onValueChange:a=>P(a.value),placeholder:"Consto Unitario"})]})]})]}),e.jsx(T,{}),e.jsx("h5",{children:"M.O./MATER."}),e.jsx("div",{class:"formgrid grid",children:e.jsxs("div",{class:"field col-4",children:[e.jsx("label",{htmlFor:"percent",className:"font-bold block mb-2",children:"Subtotal"}),e.jsxs("div",{className:"p-inputgroup flex-1",children:[e.jsx("span",{className:"p-inputgroup-addon",children:"$"}),e.jsx(d,{disabled:!0,inputId:"cantidad",value:L,onValueChange:a=>V(a.value),placeholder:"Subtotal"})]})]})})]}),e.jsx(T,{}),e.jsx("h5",{children:"Agregar algun comentario"}),e.jsx("div",{class:"formgrid grid",children:e.jsxs("div",{class:"field col-12",children:[e.jsx("label",{htmlFor:"percent",className:"font-bold block mb-2",children:"Descripcion"}),e.jsx(Me,{className:"w-full",value:B,onChange:a=>te(a.target.value),rows:2,cols:30})]})})]}),e.jsxs("div",{className:"card flex justify-content-center",children:[F&&e.jsx(De,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s"}),!F&&r===0&&e.jsx(ie,{type:"submit",label:de}),!F&&r>0&&e.jsx(ie,{label:"Aplicar % Calculo",severity:"info",onClick:a=>{a.preventDefault(),Ne()}})]})]}),e.jsx(Fe,{ref:c})]})};export{Ze as default};
//# sourceMappingURL=FormItemDetalle-86488764.js.map
