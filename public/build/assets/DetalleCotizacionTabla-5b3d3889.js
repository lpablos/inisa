import{r as n,j as t,m as L}from"./app-dcb6f552.js";import{B as c}from"./button.esm-46e694e9.js";import N from"./DialogDetalleCotizacion-978cd60e.js";import{C as U,c as q}from"./confirmdialog.esm-7f1ebc12.js";import{T as B}from"./toast.esm-b4d4ac55.js";import{T as H}from"./toolbar.esm-4deb11a8.js";import{p as v}from"./purify.es-851ec8c9.js";import{P as R}from"./progressspinner.esm-67f32af2.js";import"./componentbase.esm-1becf919.js";import"./index.esm-caaa0bd1.js";import"./iconbase.esm-565044fd.js";import"./ripple.esm-bef0a74b.js";import"./tooltip.esm-3383bdb1.js";import"./dialog.esm-84a5e061.js";import"./csstransition.esm-4d025c04.js";import"./index.esm-c88ad067.js";import"./FormItemDetalle-c55963a8.js";import"./inputnumber.esm-b35cac15.js";import"./index.esm-a09854cd.js";import"./inputtext.esm-21a8a940.js";import"./slider.esm-1d1c7285.js";import"./divider.esm-f47843a3.js";import"./dropdown.esm-e750cd64.js";import"./index.esm-727a66c6.js";import"./virtualscroller.esm-572a5462.js";import"./index.esm-bc560454.js";import"./editor.esm-330fbb63.js";import"./badge.esm-a1474c6d.js";const V={width:"100%",borderCollapse:"collapse"},i={border:"1px solid #ddd",padding:"8px",textAlign:"center",verticalAlign:"middle"},r={...i,backgroundColor:"#f2f2f2",fontWeight:"bold"},S={backgroundColor:"#fffbeb"},_t=({cotizacion:x,detalle:o,reloadList:j,onRecargaCompleta:b})=>{const h=n.useRef(null),[d,M]=n.useState([]),[f,_]=n.useState(!1);n.useEffect(async()=>{async function e(){u()}e()},[]),n.useEffect(()=>{if(j){async function e(){u(),b()}e()}},[j]);const u=async()=>{_(!0),await axios.get(`${route("cotizacion.list.detalle.cotizacion",{identy:x})}`).then(e=>{const{data:s,status:a}=e;a==200&&setTimeout(()=>{M(s),_(!1)},1e3)})},[$,w]=n.useState(),[E,D]=n.useState(!1),m=e=>{w(e),D(!0)},z=()=>{u()},y=e=>{let s=e.PDA.replace(/<[^>]*>/g,""),a=e.descripcion.replace(/<[^>]*>/g,""),p;e.es_tomo==1?p=`Al eliminar el tomo con el PDA "${s}", ten en cuenta que se se eliminar치n autom치ticamente todos los elementos internos relacionados (por ejemplo, 1.01, 1.02, entre otros).`:p=`Se eliminar el PDA "${s}", con la descripci칩n: ${a}.`,q({message:`${p}`,header:"Confirmacion de eliminaci칩n",icon:"pi pi-info-circle",defaultFocus:"reject",acceptClassName:"p-button-danger",accept:()=>O(e.id),reject:T})},O=async e=>{try{await axios.delete(`${route("tomo.detalle.elimina.identy",{id:e})}`),h.current.show({severity:"success",summary:"Eliminado correctamente",detail:"El detalle fue eliminado exitosamente.",life:3e3}),setTimeout(()=>{u(),b()},1e3)}catch{h.current.show({severity:"error",summary:"Error",detail:"No se pudo eliminar el detalle.",life:3e3})}},T=()=>{h.current.show({severity:"contrast",summary:"Correcto",detail:"Intenta con otro elemento de la lista",life:3e3})},[P,g]=n.useState(0);n.useEffect(()=>{Array.isArray(d)&&o.es_material==1&&k(),Array.isArray(d)&&o.es_mano_obra==1&&I()},[d]);const k=()=>{const e=d.filter(s=>s.es_tomo===0).reduce((s,a)=>s+(a.costo_material_subtotal||0),0);g(e)},I=()=>{const e=d.filter(s=>s.es_tomo===0).reduce((s,a)=>s+(a.obra_material_subtotal||0),0);g(e)},l=e=>`$${parseFloat(e).toFixed(2)}`,F=t.jsxs(L.Fragment,{children:["Total : ",`${l(P).toLocaleString()} ${o.moneda.abreviacion} `]});return t.jsxs("div",{className:"card",children:[f&&t.jsx("div",{className:"card flex justify-content-center",children:t.jsx(R,{})}),t.jsx(B,{ref:h}),t.jsx(U,{}),f==!1&&t.jsxs("table",{style:V,children:[t.jsxs("thead",{children:[o.es_material==1&&t.jsxs("tr",{children:[t.jsx("th",{style:r,children:"PDA"}),t.jsx("th",{style:r,children:"Descripcion"}),t.jsx("th",{style:r,children:"Material Unidad"}),t.jsx("th",{style:r,children:"Materia Cantidad"}),t.jsx("th",{style:r,children:"Material Subtotal "}),t.jsx("th",{style:r,children:"Opciones"})]}),o.es_mano_obra==1&&t.jsxs("tr",{children:[t.jsx("th",{style:r,children:"PDA"}),t.jsx("th",{style:r,children:"Descripcion"}),t.jsx("th",{style:r,children:"Material Unidad"}),t.jsx("th",{style:r,children:"Materia Cantidad"}),t.jsx("th",{style:r,children:"Material Subtotal"}),t.jsx("th",{style:r,children:"Mano Obra Costo Unitario"}),t.jsx("th",{style:r,children:"Mano Obra Subtotal"}),t.jsx("th",{style:r,children:"Material/Mano Obra Subtotal"}),t.jsx("th",{style:r,children:"Opciones"})]})]}),o.es_material==1&&t.jsx("tbody",{children:d.map(e=>{var s,a;return e.es_tomo===1?t.jsxs("tr",{style:S,children:[t.jsx("td",{style:i,children:e.PDA}),t.jsxs("td",{colSpan:4,style:i,children:[" ",t.jsxs("h6",{children:[e.descripcion," "]})]}),t.jsxs("td",{style:i,children:[t.jsx(c,{icon:"pi pi-refresh",tooltip:"Actualizar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"help","aria-label":"Actualizar",onClick:()=>{m(e)}}),t.jsx(c,{icon:"pi pi-times",tooltip:"Eliminar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"danger","aria-label":"Eliminar",onClick:()=>{y(e)}})]})]},e.id):t.jsxs("tr",{children:[t.jsx("td",{style:i,children:e.PDA}),t.jsx("td",{style:i,dangerouslySetInnerHTML:{__html:v.sanitize(e.descripcion)}}),t.jsx("td",{style:i,children:e.costo_material_cantidad}),t.jsxs("td",{style:i,children:[l(e.costo_material_unitario)," ",((s=o==null?void 0:o.moneda)==null?void 0:s.abreviacion)||""]}),t.jsxs("td",{style:i,children:[l(e.costo_material_subtotal)," ",((a=o==null?void 0:o.moneda)==null?void 0:a.abreviacion)||""]}),t.jsxs("td",{style:i,children:[t.jsx(c,{icon:"pi pi-refresh",tooltip:"Actualizar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"help","aria-label":"Actualizar",onClick:()=>{m(e)}}),t.jsx(c,{icon:"pi pi-times",tooltip:"Eliminar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"danger","aria-label":"Eliminar",onClick:()=>{y(e)}})]})]},e.id)})}),o.es_mano_obra==1&&t.jsx("tbody",{children:d.map(e=>{var s,a,p,A,C;return e.es_tomo===1?t.jsxs("tr",{style:S,children:[t.jsx("td",{style:i,children:e.PDA}),t.jsxs("td",{colSpan:7,style:i,children:[" ",t.jsx("h6",{children:e.descripcion})]}),t.jsxs("td",{style:i,children:[t.jsx(c,{icon:"pi pi-refresh",tooltip:"Actualizar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"help","aria-label":"Actualizar",onClick:()=>{m(e)}}),t.jsx(c,{icon:"pi pi-times",tooltip:"Eliminar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"danger","aria-label":"Eliminar",onClick:()=>{y(e)}})]})]},e.id):t.jsxs("tr",{children:[t.jsx("td",{style:i,children:e.PDA}),t.jsx("td",{style:i,dangerouslySetInnerHTML:{__html:v.sanitize(e.descripcion)}}),t.jsx("td",{style:i,children:e.costo_material_cantidad}),t.jsx("td",{style:i,children:e.costo_material_unitario?`${l(e.costo_material_unitario)} ${((s=o==null?void 0:o.moneda)==null?void 0:s.abreviacion)||""}`:"--"}),t.jsx("td",{style:i,children:e.costo_material_subtotal?`${l(e.costo_material_subtotal)} ${((a=o==null?void 0:o.moneda)==null?void 0:a.abreviacion)||""}`:"--"}),t.jsx("td",{style:i,children:e.costo_mano_obra_unitario?`${l(e.costo_mano_obra_unitario)} ${((p=o==null?void 0:o.moneda)==null?void 0:p.abreviacion)||""}`:"--"}),t.jsx("td",{style:i,children:e.costo_mano_obra_subtotal?`${l(e.costo_mano_obra_subtotal)} ${((A=o==null?void 0:o.moneda)==null?void 0:A.abreviacion)||""}`:"--"}),t.jsx("td",{style:i,children:e.obra_material_subtotal?`${l(e.obra_material_subtotal)} ${((C=o==null?void 0:o.moneda)==null?void 0:C.abreviacion)||""}`:"--"}),t.jsxs("td",{style:i,children:[t.jsx(c,{icon:"pi pi-refresh",tooltip:"Actualizar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"help","aria-label":"Actualizar",onClick:()=>{m(e)}}),t.jsx(c,{icon:"pi pi-times",tooltip:"Eliminar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"danger","aria-label":"Eliminar",onClick:()=>{y(e)}})]})]},e.id)})})]}),t.jsx(H,{end:F}),t.jsx(N,{cotizacion:x,detalleItem:o,detalle:$,showModalAccion:E,showbtn:!1,eventoVisible:D,recargarListado:z})]})};export{_t as default};
//# sourceMappingURL=DetalleCotizacionTabla-5b3d3889.js.map
