import{r as o,j as e,a as c}from"./app-5820f2fc.js";import{B as ae}from"./button.esm-a7803143.js";import{D as oe}from"./dialog.esm-ed12077b.js";import{I as te}from"./inputtext.esm-cd831930.js";import{F as p}from"./floatlabel.esm-7a7d3053.js";import{C as M}from"./calendar.esm-fa040edb.js";import h from"./SelectorFilter-1d910043.js";import{T as se}from"./toast.esm-a8d05a6e.js";import{C as re,c as ie}from"./confirmdialog.esm-2ae93956.js";import{S as le}from"./selectbutton.esm-a3a48e83.js";import{D as ne}from"./divider.esm-5ccc7119.js";import{F as ce}from"./fieldset.esm-3e429a37.js";import"./iconbase.esm-a7b8798a.js";import"./index.esm-d7c3364d.js";import"./ripple.esm-ee4508bf.js";import"./tooltip.esm-de61fec8.js";import"./csstransition.esm-2ed9e3b3.js";import"./index.esm-2acefc1d.js";import"./overlayservice.esm-8c1f21ea.js";import"./index.esm-c903ef93.js";import"./dropdown.esm-e42895fb.js";import"./virtualscroller.esm-34745144.js";import"./index.esm-4089079a.js";import"./index.esm-ceb7e810.js";const Le=({isEdit:l,dataToEdit:s,onSave:G,onUpdate:X,onClose:P})=>{const[k,D]=o.useState(!0),[de,H]=o.useState(null),[b,B]=o.useState(""),[E,J]=o.useState([]),[v,I]=o.useState(new Date),[x,A]=o.useState(null),[g,L]=o.useState(null),r=o.useRef(null),[y,d]=o.useState("material"),u=["Material","Material y Mano de Obra"],[m,j]=o.useState(u[0]);o.useEffect(()=>{m=="Material"&&d("material"),m=="Material y Mano de Obra"&&d("mano_obra")},[m]),o.useEffect(()=>{y=="material"?j(u[0]):j(u[1])},[y]);const[_,Z]=o.useState(null),[O,K]=o.useState([]),[ue,Q]=o.useState("");o.useEffect(()=>{(async()=>{try{const t=await c.get(route("catalogo.list.clientes"));K(t.data)}catch{r.current.show({severity:"error",summary:"Error",detail:"No se pudo obtener la lista de clientes.",life:3e3})}})()},[]);const[S,w]=o.useState({id:3,nombre:"Peso Mexicano",abreviacion:"MXN",created_at:"2025-01-08T07:50:51.000000Z",updated_at:"2025-01-08T07:50:51.000000Z"}),[R,T]=o.useState([]);o.useEffect(()=>{(async()=>{try{const t=await c.get(route("catalogo.list.tiposmonedas"));T(t.data)}catch{r.current.show({severity:"error",summary:"Error",detail:"No se pudo obtener la lista de monedas.",life:3e3})}})()},[]);const[C,N]=o.useState({id:2,nombre:"Media",descripcion:"Prioridad Media",created_at:"2025-01-08T07:50:49.000000Z",updated_at:"2025-01-08T07:50:49.000000Z"}),[V,U]=o.useState([]);o.useEffect(()=>{(async()=>{try{const t=await c.get(route("catalogo.list.prioridades"));U(t.data)}catch{r.current.show({severity:"error",summary:"Error",detail:"No se pudo obtener la lista de prioridades.",life:3e3})}})()},[]);const[z,F]=o.useState(null),[q,W]=o.useState([]);o.useEffect(()=>{(async()=>{try{const t=await c.get(route("catalogo.list.status"));W(t.data)}catch{r.current.show({severity:"error",summary:"Error",detail:"No se pudo obtener la lista de statuses.",life:3e3})}})()},[]),o.useEffect(()=>{(async()=>{try{const t=await c.get(route("catalogo.list.provedores"));J(t.data)}catch{r.current.show({severity:"error",summary:"Error",detail:"No se pudo obtener la lista de proveedores.",life:3e3})}})()},[]),o.useEffect(()=>{if(l&&s){B(s.titulo||""),I(new Date(s.fecha)||null),L(new Date(s.fecha_cotiza_fin)||null),A(new Date(s.fecha_cotiza_inicio)||null),d(s.es_material||"");let a;s.es_mano_obra==1?a="mano_obra":a="material",d(a),Q(s.ingredient||"");const t=E.find(i=>i.id===s.provedor_id);H(t||null);const n=q.find(i=>i.id===s.status_id);F(n||null);const f=R.find(i=>i.id===s.cat_moneda_id);w(f||null);const $=O.find(i=>i.id===s.cliente_id);Z($||null);const ee=V.find(i=>i.id===s.cat_prioridad_id);N(ee||null)}},[l,s,E]);const Y=async()=>{if(!b||!v||!z||!S||!_||!C||!x||!g){r.current.show({severity:"warn",summary:"Campos incompletos",detail:"Todos los campos son obligatorios.",life:3e3});return}const a={status_id:z.id,moneda_id:S.id,cliente_id:_.id,prioridad_id:C.id,titulo:b,fecha:v,fecha_inicio_cotizacion:x,fecha_final_cotizacion:g,es_material:y};ie({message:l?"¿Está seguro de que desea actualizar esta cotización?":"¿Está seguro de que desea crear esta cotización?",header:l?"Confirmar Actualización":"Confirmar Creación",icon:"pi pi-exclamation-triangle",accept:async()=>{try{if(l)(await c.put(route("cotizacion.actualiza.cotizacion",{id:s.id}),a)).status===200&&(r.current.show({severity:"success",summary:"Éxito",detail:"Cotización actualizada correctamente.",life:3e3}),X());else{const n=await c.post(route("cotizacion.registrar.cotizacion"),a);console.log("Esto devuelve ---->=>",n);const{folio:f}=n.data.data;n.status===201&&(console.log("Este es el dato ",f),r.current.show({severity:"info",summary:"Cotizacion Registrada",detail:"Cotizacion con Folio '"+f+'"',life:5e3}),G())}D(!1),P()}catch{r.current.show({severity:"error",summary:"Error inesperado",detail:"No se pudo procesar la solicitud.",life:3e3})}},reject:()=>{r.current.show({severity:"info",summary:"Acción cancelada",detail:"No se realizó ningún cambio.",life:3e3})}})};return o.useEffect(()=>{setTimeout(()=>{F({id:3,nombre:"EnProcesoFaltaAlgo",abreviacion:"!",descripcion:"En Proceso O Falta Algo"})},1e3),setTimeout(()=>{N({id:4,nombre:"Baja",descripcion:"Puede atenderse después de las prioridades más altas"})},1100),setTimeout(()=>{w({id:3,nombre:"Peso Mexicano",abreviacion:"MXN"})},1200)},[]),e.jsxs(e.Fragment,{children:[e.jsx(re,{}),e.jsxs(oe,{header:l?"Detalle Cotización":"Nueva Cotización",visible:k,maximizable:!0,style:{width:"80vw"},onHide:()=>{D(!1),P()},children:[e.jsx(se,{ref:r}),e.jsxs("div",{className:"grid my-5",children:[e.jsxs("div",{className:"col-6 md:col-12 mb-3",children:[e.jsx("label",{htmlFor:"titulo",children:"Título"}),e.jsx(p,{children:e.jsx(te,{id:"titulo",value:b,onChange:a=>B(a.target.value),className:"w-full"})})]}),e.jsxs("div",{className:"col-6 md:col-12 mb-3",children:[e.jsx("label",{htmlFor:"Cliente",children:"Cliente"}),e.jsx(h,{className:"mb-3 col-12",value:_,onChange:a=>Z(a.value),options:O,optionLabel:"nombre",placeholder:"Seleccione un Cliente",filter:!0,filterBy:"nombre",showClear:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 items-start",children:[e.jsx("div",{className:"col-span-1 m-4",children:e.jsxs(p,{children:[e.jsx(M,{id:"fecha",value:v,onChange:a=>I(a.value),className:"w-full",showIcon:!0,dateFormat:"dd/mm/yy"}),e.jsx("label",{htmlFor:"fecha",children:"Fecha"})]})}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{htmlFor:"selectPlantilla",className:"m-3",children:"Selecciona la plantilla"}),e.jsx(le,{value:m,onChange:a=>j(a.value),options:u})]})]}),e.jsx(ne,{}),e.jsx(ce,{legend:"Periodo de Validez",className:"col-12",children:e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("div",{className:"col-4 md:col-4",children:e.jsxs(p,{children:[e.jsx(M,{id:"fecha_inicio_cotizacion",value:x,onChange:a=>A(a.value),className:"w-full",showIcon:!0,dateFormat:"dd/mm/yy"}),e.jsx("label",{htmlFor:"fecha_inicio_cotizacion",children:"Fecha inicio Cotizacion"})]})}),e.jsx("div",{className:"col-4 md:col-4",children:e.jsxs(p,{children:[e.jsx(M,{id:"fecha_fin_cotizacion",value:g,onChange:a=>L(a.value),className:"w-full",showIcon:!0,dateFormat:"dd/mm/yy"}),e.jsx("label",{htmlFor:"fecha_fin_cotizacion",children:"Fecha fin Cotizacion"})]})})]})}),e.jsxs("div",{className:"col-4",children:[e.jsx("label",{htmlFor:"proveedor",children:"Status"}),e.jsx(h,{className:"mb-3 col-12",value:z,onChange:a=>F(a.value),options:q,optionLabel:"descripcion",placeholder:"Seleccione un status",filter:!0,filterBy:"nombre",showClear:!0})]}),e.jsxs("div",{className:"col-4",children:[e.jsx("label",{htmlFor:"prioridad",children:"Prioridad"}),e.jsx(h,{className:"mb-3 col-12",value:C,onChange:a=>N(a.value),options:V,optionLabel:"nombre",placeholder:"Seleccione un Prioridad",filter:!0,filterBy:"nombre",showClear:!0})]}),e.jsxs("div",{className:"col-4",children:[e.jsx("label",{htmlFor:"Moneda",children:"Moneda"}),e.jsx(h,{className:"mb-3 col-12",value:S,onChange:a=>w(a.value),options:R,optionLabel:"nombre",placeholder:"Seleccione una Moneda",filter:!0,filterBy:"nombre",showClear:!0})]}),e.jsx("div",{className:"col-12",children:e.jsx(ae,{label:l?"Actualizar":"Guardar",onClick:Y,className:"p-button-success"})})]})]})]})};export{Le as default};
//# sourceMappingURL=Dialogo-404ea213.js.map
