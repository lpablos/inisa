import{r as i,P as F,O as w,c as L,j as t,m as H}from"./app-19db06cb.js";import{B as u}from"./button.esm-8dbecc90.js";import J from"./DialogDetalleCotizacion-78631308.js";import{C as X,c as q}from"./confirmdialog.esm-4bbc3da3.js";import{T as V}from"./toast.esm-0ed1f3f5.js";import{C as W,u as Y,a as G}from"./iconbase.esm-8ede90bc.js";import{p as T}from"./purify.es-851ec8c9.js";import{P as K}from"./progressspinner.esm-6354dbd6.js";import"./index.esm-e985f2f4.js";import"./ripple.esm-586a3f44.js";import"./tooltip.esm-01d8262e.js";import"./dialog.esm-18943087.js";import"./csstransition.esm-dcf34adf.js";import"./index.esm-a014419b.js";import"./FormItemDetalle-84e77b9f.js";import"./inputnumber.esm-1f5b4141.js";import"./index.esm-4dc81cb8.js";import"./inputtext.esm-06be2f11.js";import"./divider.esm-09bb4f3c.js";import"./dropdown.esm-5f54d0b4.js";import"./overlayservice.esm-1e88b1a3.js";import"./index.esm-19bb07b4.js";import"./virtualscroller.esm-3b43f60c.js";import"./index.esm-2b3c0470.js";import"./editor.esm-aa5ccd94.js";import"./badge.esm-ac2e5e14.js";var C=W.extend({defaultProps:{__TYPE:"Toolbar",id:null,style:null,className:null,left:null,right:null,start:null,center:null,end:null,children:void 0},css:{classes:{root:"p-toolbar p-component",start:"p-toolbar-group-start p-toolbar-group-left",center:"p-toolbar-group-center",end:"p-toolbar-group-end p-toolbar-group-right"},styles:`
        @layer primereact {
            .p-toolbar {
                display: flex;
                align-items: center;
                justify-content: space-between;
                flex-wrap: wrap;
            }
            
            .p-toolbar-group-start,
            .p-toolbar-group-center,
            .p-toolbar-group-end {
                display: flex;
                align-items: center;
            }
            
            .p-toolbar-group-left,
            .p-toolbar-group-right {
                display: flex;
                align-items: center;
            }
        }
        `}}),N=i.memo(i.forwardRef(function(j,o){var m=Y(),_=i.useContext(F),a=C.getProps(j,_),c=i.useRef(null),E=w.getJSXElement(a.left||a.start,a),g=w.getJSXElement(a.center,a),D=w.getJSXElement(a.right||a.end,a),d=C.setMetaData({props:a}),h=d.ptm,y=d.cx,A=d.isUnstyled;G(C.css.styles,A,{name:"toolbar"}),i.useImperativeHandle(o,function(){return{props:a,getElement:function(){return c.current}}});var v=m({className:y("start")},h("start")),x=m({className:y("center")},h("center")),S=m({className:y("end")},h("end")),b=m({id:a.id,ref:c,style:a.style,className:L(a.className,y("root")),role:"toolbar"},C.getOtherProps(a),h("root"));return i.createElement("div",b,i.createElement("div",v,E),i.createElement("div",x,g),i.createElement("div",S,D))}));N.displayName="Toolbar";const Q={width:"100%",borderCollapse:"collapse"},r={border:"1px solid #ddd",padding:"8px",textAlign:"center",verticalAlign:"middle"},n={...r,backgroundColor:"#f2f2f2",fontWeight:"bold"},z={backgroundColor:"#fffbeb"},Et=({cotizacion:j,detalle:o,reloadList:m,onRecargaCompleta:_})=>{const a=i.useRef(null),[c,E]=i.useState([]),[g,D]=i.useState(!1);i.useEffect(async()=>{async function e(){d()}e()},[]),i.useEffect(()=>{if(m){async function e(){d(),_()}e()}},[m]);const d=async()=>{D(!0),await axios.get(`${route("cotizacion.list.detalle.cotizacion",{identy:j})}`).then(e=>{const{data:s,status:l}=e;l==200&&setTimeout(()=>{E(s),D(!1)},1e3)})},[h,y]=i.useState(),[A,v]=i.useState(!1),x=e=>{y(e),v(!0)},S=()=>{d()},b=e=>{let s=e.PDA.replace(/<[^>]*>/g,""),l=e.descripcion.replace(/<[^>]*>/g,""),f;e.es_tomo==1?f=`Al eliminar el tomo con el PDA "${s}", ten en cuenta que se se eliminar치n autom치ticamente todos los elementos internos relacionados (por ejemplo, 1.01, 1.02, entre otros).`:f=`Se eliminar el PDA "${s}", con la descripci칩n: ${l}.`,q({message:`${f}`,header:"Confirmacion de eliminaci칩n",icon:"pi pi-info-circle",defaultFocus:"reject",acceptClassName:"p-button-danger",accept:()=>M(e.id),reject:k})},M=async e=>{try{await axios.delete(`${route("tomo.detalle.elimina.identy",{id:e})}`),a.current.show({severity:"success",summary:"Eliminado correctamente",detail:"El detalle fue eliminado exitosamente.",life:3e3}),setTimeout(()=>{d(),_()},1e3)}catch{a.current.show({severity:"error",summary:"Error",detail:"No se pudo eliminar el detalle.",life:3e3})}},k=()=>{a.current.show({severity:"contrast",summary:"Correcto",detail:"Intenta con otro elemento de la lista",life:3e3})},[I,P]=i.useState(0);i.useEffect(()=>{Array.isArray(c)&&o.es_material==1&&U(),Array.isArray(c)&&o.es_mano_obra==1&&R()},[c]);const U=()=>{const e=c.filter(s=>s.es_tomo===0).reduce((s,l)=>s+(l.costo_material_subtotal||0),0);P(e)},R=()=>{const e=c.filter(s=>s.es_tomo===0).reduce((s,l)=>s+(l.obra_material_subtotal||0),0);P(e)},p=e=>`$${parseFloat(e).toFixed(2)}`,B=t.jsxs(H.Fragment,{children:["Total : ",`${p(I).toLocaleString()} ${o.moneda.abreviacion} `]});return t.jsxs("div",{className:"card",children:[g&&t.jsx("div",{className:"card flex justify-content-center",children:t.jsx(K,{})}),t.jsx(V,{ref:a}),t.jsx(X,{}),g==!1&&t.jsxs("table",{style:Q,children:[t.jsxs("thead",{children:[o.es_material==1&&t.jsxs("tr",{children:[t.jsx("th",{style:n,children:"PDA"}),t.jsx("th",{style:n,children:"Descripcion"}),t.jsx("th",{style:n,children:"Material Unidad"}),t.jsx("th",{style:n,children:"Materia Cantidad"}),t.jsx("th",{style:n,children:"Material Subtotal "}),t.jsx("th",{style:n,children:"Opciones"})]}),o.es_mano_obra==1&&t.jsxs("tr",{children:[t.jsx("th",{style:n,children:"PDA"}),t.jsx("th",{style:n,children:"Descripcion"}),t.jsx("th",{style:n,children:"Material Unidad"}),t.jsx("th",{style:n,children:"Materia Cantidad"}),t.jsx("th",{style:n,children:"Material Subtotal"}),t.jsx("th",{style:n,children:"Mano Obra Costo Unitario"}),t.jsx("th",{style:n,children:"Mano Obra Subtotal"}),t.jsx("th",{style:n,children:"Material/Mano Obra Subtotal"}),t.jsx("th",{style:n,children:"Opciones"})]})]}),o.es_material==1&&t.jsx("tbody",{children:c.map(e=>{var s,l;return e.es_tomo===1?t.jsxs("tr",{style:z,children:[t.jsx("td",{style:r,children:e.PDA}),t.jsxs("td",{colSpan:4,style:r,children:[" ",t.jsxs("h6",{children:[e.descripcion," "]})]}),t.jsxs("td",{style:r,children:[t.jsx(u,{icon:"pi pi-refresh",tooltip:"Actualizar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"help","aria-label":"Actualizar",onClick:()=>{x(e)}}),t.jsx(u,{icon:"pi pi-times",tooltip:"Eliminar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"danger","aria-label":"Eliminar",onClick:()=>{b(e)}})]})]},e.id):t.jsxs("tr",{children:[t.jsx("td",{style:r,children:e.PDA}),t.jsx("td",{style:r,dangerouslySetInnerHTML:{__html:T.sanitize(e.descripcion)}}),t.jsx("td",{style:r,children:e.costo_material_cantidad}),t.jsxs("td",{style:r,children:[p(e.costo_material_unitario)," ",((s=o==null?void 0:o.moneda)==null?void 0:s.abreviacion)||""]}),t.jsxs("td",{style:r,children:[p(e.costo_material_subtotal)," ",((l=o==null?void 0:o.moneda)==null?void 0:l.abreviacion)||""]}),t.jsxs("td",{style:r,children:[t.jsx(u,{icon:"pi pi-refresh",tooltip:"Actualizar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"help","aria-label":"Actualizar",onClick:()=>{x(e)}}),t.jsx(u,{icon:"pi pi-times",tooltip:"Eliminar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"danger","aria-label":"Eliminar",onClick:()=>{b(e)}})]})]},e.id)})}),o.es_mano_obra==1&&t.jsx("tbody",{children:c.map(e=>{var s,l,f,$,O;return e.es_tomo===1?t.jsxs("tr",{style:z,children:[t.jsx("td",{style:r,children:e.PDA}),t.jsxs("td",{colSpan:7,style:r,children:[" ",t.jsx("h6",{children:e.descripcion})]}),t.jsxs("td",{style:r,children:[t.jsx(u,{icon:"pi pi-refresh",tooltip:"Actualizar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"help","aria-label":"Actualizar",onClick:()=>{x(e)}}),t.jsx(u,{icon:"pi pi-times",tooltip:"Eliminar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"danger","aria-label":"Eliminar",onClick:()=>{b(e)}})]})]},e.id):t.jsxs("tr",{children:[t.jsx("td",{style:r,children:e.PDA}),t.jsx("td",{style:r,dangerouslySetInnerHTML:{__html:T.sanitize(e.descripcion)}}),t.jsx("td",{style:r,children:e.costo_material_cantidad}),t.jsx("td",{style:r,children:e.costo_material_unitario?`${p(e.costo_material_unitario)} ${((s=o==null?void 0:o.moneda)==null?void 0:s.abreviacion)||""}`:"--"}),t.jsx("td",{style:r,children:e.costo_material_subtotal?`${p(e.costo_material_subtotal)} ${((l=o==null?void 0:o.moneda)==null?void 0:l.abreviacion)||""}`:"--"}),t.jsx("td",{style:r,children:e.costo_mano_obra_unitario?`${p(e.costo_mano_obra_unitario)} ${((f=o==null?void 0:o.moneda)==null?void 0:f.abreviacion)||""}`:"--"}),t.jsx("td",{style:r,children:e.costo_mano_obra_subtotal?`${p(e.costo_mano_obra_subtotal)} ${(($=o==null?void 0:o.moneda)==null?void 0:$.abreviacion)||""}`:"--"}),t.jsx("td",{style:r,children:e.obra_material_subtotal?`${p(e.obra_material_subtotal)} ${((O=o==null?void 0:o.moneda)==null?void 0:O.abreviacion)||""}`:"--"}),t.jsxs("td",{style:r,children:[t.jsx(u,{icon:"pi pi-refresh",tooltip:"Actualizar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"help","aria-label":"Actualizar",onClick:()=>{x(e)}}),t.jsx(u,{icon:"pi pi-times",tooltip:"Eliminar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"danger","aria-label":"Eliminar",onClick:()=>{b(e)}})]})]},e.id)})})]}),t.jsx(N,{end:B}),t.jsx(J,{cotizacion:j,detalleItem:o,detalle:h,showModalAccion:A,showbtn:!1,eventoVisible:v,recargarListado:S})]})};export{Et as default};
//# sourceMappingURL=DetalleCotizacionTabla-25476c67.js.map
