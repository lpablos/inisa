import{r as i,P as F,O as w,c as L,j as e,m as H}from"./app-dd05d154.js";import{B as u}from"./button.esm-ceaa1394.js";import J from"./DialogDetalleCotizacion-f16bae8a.js";import{C as X,c as q}from"./confirmdialog.esm-b39e6044.js";import{T as V}from"./toast.esm-3c5da315.js";import{C as W,u as Y,a as G}from"./ripple.esm-f46f8654.js";import{p as T}from"./purify.es-851ec8c9.js";import{P as K}from"./progressspinner.esm-3a320bfa.js";import"./tooltip.esm-4fb46b8c.js";import"./dialog.esm-08b8fe93.js";import"./index.esm-0900a10d.js";import"./FormItemDetalle-a177ddba.js";import"./inputnumber.esm-c3e00d7e.js";import"./index.esm-52bb2cca.js";import"./inputtext.esm-0282332f.js";import"./divider.esm-03c9c46a.js";import"./dropdown.esm-65349b16.js";import"./overlayservice.esm-a15357fc.js";import"./index.esm-8e77f6ec.js";import"./editor.esm-5532de27.js";import"./badge.esm-c6f88795.js";var C=W.extend({defaultProps:{__TYPE:"Toolbar",id:null,style:null,className:null,left:null,right:null,start:null,center:null,end:null,children:void 0},css:{classes:{root:"p-toolbar p-component",start:"p-toolbar-group-start p-toolbar-group-left",center:"p-toolbar-group-center",end:"p-toolbar-group-end p-toolbar-group-right"},styles:`
        @layer primereact {
            .p-toolbar {
                display: flex;
                align-items: center;
                justify-content: space-between;
                flex-wrap: wrap;
            }
            
            .p-toolbar-group-start,
            .p-toolbar-group-center,
            .p-toolbar-group-end {
                display: flex;
                align-items: center;
            }
            
            .p-toolbar-group-left,
            .p-toolbar-group-right {
                display: flex;
                align-items: center;
            }
        }
        `}}),N=i.memo(i.forwardRef(function(j,o){var m=Y(),_=i.useContext(F),a=C.getProps(j,_),c=i.useRef(null),E=w.getJSXElement(a.left||a.start,a),g=w.getJSXElement(a.center,a),D=w.getJSXElement(a.right||a.end,a),d=C.setMetaData({props:a}),h=d.ptm,y=d.cx,A=d.isUnstyled;G(C.css.styles,A,{name:"toolbar"}),i.useImperativeHandle(o,function(){return{props:a,getElement:function(){return c.current}}});var v=m({className:y("start")},h("start")),x=m({className:y("center")},h("center")),S=m({className:y("end")},h("end")),b=m({id:a.id,ref:c,style:a.style,className:L(a.className,y("root")),role:"toolbar"},C.getOtherProps(a),h("root"));return i.createElement("div",b,i.createElement("div",v,E),i.createElement("div",x,g),i.createElement("div",S,D))}));N.displayName="Toolbar";const Q={width:"100%",borderCollapse:"collapse"},r={border:"1px solid #ddd",padding:"8px",textAlign:"center",verticalAlign:"middle"},n={...r,backgroundColor:"#f2f2f2",fontWeight:"bold"},z={backgroundColor:"#fffbeb"},_e=({cotizacion:j,detalle:o,reloadList:m,onRecargaCompleta:_})=>{const a=i.useRef(null),[c,E]=i.useState([]),[g,D]=i.useState(!1);i.useEffect(async()=>{async function t(){d()}t()},[]),i.useEffect(()=>{if(m){async function t(){d(),_()}t()}},[m]);const d=async()=>{D(!0),await axios.get(`${route("cotizacion.list.detalle.cotizacion",{identy:j})}`).then(t=>{const{data:s,status:l}=t;l==200&&setTimeout(()=>{E(s),D(!1)},1e3)})},[h,y]=i.useState(),[A,v]=i.useState(!1),x=t=>{y(t),v(!0)},S=()=>{d()},b=t=>{let s=t.PDA.replace(/<[^>]*>/g,""),l=t.descripcion.replace(/<[^>]*>/g,""),f;t.es_tomo==1?f=`Al eliminar el tomo con el PDA "${s}", ten en cuenta que se se eliminar치n autom치ticamente todos los elementos internos relacionados (por ejemplo, 1.01, 1.02, entre otros).`:f=`Se eliminar el PDA "${s}", con la descripci칩n: ${l}.`,q({message:`${f}`,header:"Confirmacion de eliminaci칩n",icon:"pi pi-info-circle",defaultFocus:"reject",acceptClassName:"p-button-danger",accept:()=>M(t.id),reject:k})},M=async t=>{try{await axios.delete(`${route("tomo.detalle.elimina.identy",{id:t})}`),a.current.show({severity:"success",summary:"Eliminado correctamente",detail:"El detalle fue eliminado exitosamente.",life:3e3}),setTimeout(()=>{d(),_()},1e3)}catch{a.current.show({severity:"error",summary:"Error",detail:"No se pudo eliminar el detalle.",life:3e3})}},k=()=>{a.current.show({severity:"contrast",summary:"Correcto",detail:"Intenta con otro elemento de la lista",life:3e3})},[I,P]=i.useState(0);i.useEffect(()=>{Array.isArray(c)&&o.es_material==1&&U(),Array.isArray(c)&&o.es_mano_obra==1&&R()},[c]);const U=()=>{const t=c.filter(s=>s.es_tomo===0).reduce((s,l)=>s+(l.costo_material_subtotal||0),0);P(t)},R=()=>{const t=c.filter(s=>s.es_tomo===0).reduce((s,l)=>s+(l.obra_material_subtotal||0),0);P(t)},p=t=>`$${parseFloat(t).toFixed(2)}`,B=e.jsxs(H.Fragment,{children:["Total : ",`${p(I).toLocaleString()} ${o.moneda.abreviacion} `]});return e.jsxs("div",{className:"card",children:[g&&e.jsx("div",{className:"card flex justify-content-center",children:e.jsx(K,{})}),e.jsx(V,{ref:a}),e.jsx(X,{}),g==!1&&e.jsxs("table",{style:Q,children:[e.jsxs("thead",{children:[o.es_material==1&&e.jsxs("tr",{children:[e.jsx("th",{style:n,children:"PDA"}),e.jsx("th",{style:n,children:"Descripcion"}),e.jsx("th",{style:n,children:"Material Unidad"}),e.jsx("th",{style:n,children:"Materia Cantidad"}),e.jsx("th",{style:n,children:"Material Subtotal "}),e.jsx("th",{style:n,children:"Opciones"})]}),o.es_mano_obra==1&&e.jsxs("tr",{children:[e.jsx("th",{style:n,children:"PDA"}),e.jsx("th",{style:n,children:"Descripcion"}),e.jsx("th",{style:n,children:"Material Unidad"}),e.jsx("th",{style:n,children:"Materia Cantidad"}),e.jsx("th",{style:n,children:"Material Subtotal"}),e.jsx("th",{style:n,children:"Mano Obra Costo Unitario"}),e.jsx("th",{style:n,children:"Mano Obra Subtotal"}),e.jsx("th",{style:n,children:"Material/Mano Obra Subtotal"}),e.jsx("th",{style:n,children:"Opciones"})]})]}),o.es_material==1&&e.jsx("tbody",{children:c.map(t=>{var s,l;return t.es_tomo===1?e.jsxs("tr",{style:z,children:[e.jsx("td",{style:r,children:t.PDA}),e.jsxs("td",{colSpan:4,style:r,children:[" ",e.jsxs("h6",{children:[t.descripcion," "]})]}),e.jsxs("td",{style:r,children:[e.jsx(u,{icon:"pi pi-refresh",tooltip:"Actualizar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"help","aria-label":"Actualizar",onClick:()=>{x(t)}}),e.jsx(u,{icon:"pi pi-times",tooltip:"Eliminar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"danger","aria-label":"Eliminar",onClick:()=>{b(t)}})]})]},t.id):e.jsxs("tr",{children:[e.jsx("td",{style:r,children:t.PDA}),e.jsx("td",{style:r,dangerouslySetInnerHTML:{__html:T.sanitize(t.descripcion)}}),e.jsx("td",{style:r,children:t.costo_material_cantidad}),e.jsxs("td",{style:r,children:[p(t.costo_material_unitario)," ",((s=o==null?void 0:o.moneda)==null?void 0:s.abreviacion)||""]}),e.jsxs("td",{style:r,children:[p(t.costo_material_subtotal)," ",((l=o==null?void 0:o.moneda)==null?void 0:l.abreviacion)||""]}),e.jsxs("td",{style:r,children:[e.jsx(u,{icon:"pi pi-refresh",tooltip:"Actualizar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"help","aria-label":"Actualizar",onClick:()=>{x(t)}}),e.jsx(u,{icon:"pi pi-times",tooltip:"Eliminar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"danger","aria-label":"Eliminar",onClick:()=>{b(t)}})]})]},t.id)})}),o.es_mano_obra==1&&e.jsx("tbody",{children:c.map(t=>{var s,l,f,$,O;return t.es_tomo===1?e.jsxs("tr",{style:z,children:[e.jsx("td",{style:r,children:t.PDA}),e.jsxs("td",{colSpan:7,style:r,children:[" ",e.jsx("h6",{children:t.descripcion})]}),e.jsxs("td",{style:r,children:[e.jsx(u,{icon:"pi pi-refresh",tooltip:"Actualizar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"help","aria-label":"Actualizar",onClick:()=>{x(t)}}),e.jsx(u,{icon:"pi pi-times",tooltip:"Eliminar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"danger","aria-label":"Eliminar",onClick:()=>{b(t)}})]})]},t.id):e.jsxs("tr",{children:[e.jsx("td",{style:r,children:t.PDA}),e.jsx("td",{style:r,dangerouslySetInnerHTML:{__html:T.sanitize(t.descripcion)}}),e.jsx("td",{style:r,children:t.costo_material_cantidad}),e.jsx("td",{style:r,children:t.costo_material_unitario?`${p(t.costo_material_unitario)} ${((s=o==null?void 0:o.moneda)==null?void 0:s.abreviacion)||""}`:"--"}),e.jsx("td",{style:r,children:t.costo_material_subtotal?`${p(t.costo_material_subtotal)} ${((l=o==null?void 0:o.moneda)==null?void 0:l.abreviacion)||""}`:"--"}),e.jsx("td",{style:r,children:t.costo_mano_obra_unitario?`${p(t.costo_mano_obra_unitario)} ${((f=o==null?void 0:o.moneda)==null?void 0:f.abreviacion)||""}`:"--"}),e.jsx("td",{style:r,children:t.costo_mano_obra_subtotal?`${p(t.costo_mano_obra_subtotal)} ${(($=o==null?void 0:o.moneda)==null?void 0:$.abreviacion)||""}`:"--"}),e.jsx("td",{style:r,children:t.obra_material_subtotal?`${p(t.obra_material_subtotal)} ${((O=o==null?void 0:o.moneda)==null?void 0:O.abreviacion)||""}`:"--"}),e.jsxs("td",{style:r,children:[e.jsx(u,{icon:"pi pi-refresh",tooltip:"Actualizar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"help","aria-label":"Actualizar",onClick:()=>{x(t)}}),e.jsx(u,{icon:"pi pi-times",tooltip:"Eliminar",tooltipOptions:{showDelay:100,hideDelay:300},rounded:!0,text:!0,severity:"danger","aria-label":"Eliminar",onClick:()=>{b(t)}})]})]},t.id)})})]}),e.jsx(N,{end:B}),e.jsx(J,{cotizacion:j,detalleItem:o,detalle:h,showModalAccion:A,showbtn:!1,eventoVisible:v,recargarListado:S})]})};export{_e as default};
