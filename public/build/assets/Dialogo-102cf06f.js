import{r as a,P as pe,D as be,O as F,c as K,j as o,a as O}from"./app-dd05d154.js";import{B as ve}from"./button.esm-ceaa1394.js";import{D as he}from"./dialog.esm-08b8fe93.js";import{I as ye}from"./inputtext.esm-0282332f.js";import{F as k}from"./floatlabel.esm-c740ac00.js";import{C as W}from"./calendar.esm-5fe05d63.js";import L from"./SelectorFilter-6653da12.js";import{T as ge}from"./toast.esm-3c5da315.js";import{C as xe,c as Se}from"./confirmdialog.esm-b39e6044.js";import{D as _e}from"./divider.esm-03c9c46a.js";import{F as we}from"./fieldset.esm-74d0e1be.js";import{C as Ce,u as ne,a as je,R as Ne}from"./ripple.esm-f46f8654.js";import{T as Fe}from"./tooltip.esm-4fb46b8c.js";import"./index.esm-0900a10d.js";import"./overlayservice.esm-a15357fc.js";import"./index.esm-c36ca71f.js";import"./dropdown.esm-65349b16.js";import"./index.esm-8e77f6ec.js";import"./index.esm-871fef04.js";function J(){return J=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&(e[u]=r[u])}return e},J.apply(this,arguments)}function Y(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,u=new Array(n);r<n;r++)u[r]=e[r];return u}function Pe(e){if(Array.isArray(e))return Y(e)}function De(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function oe(e,n){if(e){if(typeof e=="string")return Y(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Y(e,n)}}function ze(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ae(e){return Pe(e)||De(e)||oe(e)||ze()}function Ie(e){if(Array.isArray(e))return e}function Ee(e,n){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var u,t,C,y,j=[],g=!0,m=!1;try{if(C=(r=r.call(e)).next,n===0){if(Object(r)!==r)return;g=!1}else for(;!(g=(u=C.call(r)).done)&&(j.push(u.value),j.length!==n);g=!0);}catch(S){m=!0,t=S}finally{try{if(!g&&r.return!=null&&(y=r.return(),Object(y)!==y))return}finally{if(m)throw t}}return j}}function Oe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function re(e,n){return Ie(e)||Ee(e,n)||oe(e,n)||Oe()}var Ae={root:function(n){var r=n.props;return K("p-selectbutton p-button-group p-component",{"p-invalid":r.invalid})},button:function(n){var r=n.itemProps,u=n.focusedState;return K("p-button p-component",{"p-highlight":r.selected,"p-disabled":r.disabled,"p-focus":u})},label:"p-button-label p-c"},V=Ce.extend({defaultProps:{__TYPE:"SelectButton",id:null,value:null,options:null,optionLabel:null,optionValue:null,optionDisabled:null,tabIndex:null,multiple:!1,invalid:!1,unselectable:!0,allowEmpty:!0,disabled:!1,style:null,className:null,dataKey:null,tooltip:null,tooltipOptions:null,itemTemplate:null,onChange:null,children:void 0},css:{classes:Ae}}),le=a.memo(function(e){var n=a.useState(!1),r=re(n,2),u=r[0],t=r[1],C=ne(),y=e.ptm,j=e.cx,g=function(i){return y(i,{hostName:e.hostName,context:{selected:e.selected,disabled:e.disabled,option:e.option}})},m=function(i,c){e.setFocusedIndex(c),e.onClick&&e.onClick({originalEvent:i,option:e.option})},S=function(){t(!0)},P=function(){t(!1)},A=function(i,c){switch(i.code){case"Space":{m(i,c),i.preventDefault();break}case"ArrowDown":case"ArrowRight":{D(i,"next"),i.preventDefault();break}case"ArrowUp":case"ArrowLeft":{D(i,"prev"),i.preventDefault();break}}},D=function(i,c){for(var x,b,v=0;v<=e.elementRef.current.children.length-1;v++)e.elementRef.current.children[v].getAttribute("tabindex")==="0"&&(x={elem:e.elementRef.current.children[v],index:v});c==="prev"?x.index===0?b=e.elementRef.current.children.length-1:b=x.index-1:x.index===e.elementRef.current.children.length-1?b=0:b=x.index+1,e.setFocusedIndex(b),e.elementRef.current.children[b].focus()},M=function(){var i=C({className:j("label")},g("label"));return e.template?F.getJSXElement(e.template,e.option):a.createElement("span",i,e.label)},z=M(),I=C({className:K(e.className,j("button",{itemProps:e,focusedState:u})),role:"button","aria-label":e.label,"aria-pressed":e.selected,onClick:function(i){return m(i,e.index)},onKeyDown:function(i){return A(i,e.index)},tabIndex:e.tabIndex,"aria-disabled":e.disabled,onFocus:S,onBlur:P},g("button"));return a.createElement("div",I,z,!e.disabled&&a.createElement(Ne,null))});le.displayName="SelectButtonItem";var se=a.memo(a.forwardRef(function(e,n){var r=ne(),u=a.useContext(pe),t=V.getProps(e,u),C=a.useState(0),y=re(C,2),j=y[0],g=y[1],m=a.useRef(null),S=V.setMetaData({props:t}),P=S.ptm,A=S.cx,D=S.isUnstyled;je(V.css.styles,D,{name:"selectbutton",styled:!0});var M=function(l){if(!(t.disabled||f(l.option))){var p=i(l.option);if(!(p&&!(t.unselectable&&t.allowEmpty))){var _=I(l.option),w;if(t.multiple){var R=t.value?ae(t.value):[];w=p?R.filter(function(B){return!F.equals(B,_,t.dataKey)}):[].concat(ae(R),[_])}else w=p?null:_;t.onChange&&t.onChange({originalEvent:l.originalEvent,value:w,stopPropagation:function(){l.originalEvent.stopPropagation()},preventDefault:function(){l.originalEvent.preventDefault()},target:{name:t.name,id:t.id,value:w}})}}},z=function(l){return t.optionLabel?F.resolveFieldData(l,t.optionLabel):l&&l.label!==void 0?l.label:l},I=function(l){return t.optionValue?F.resolveFieldData(l,t.optionValue):l&&l.value!==void 0?l.value:l},f=function(l){return t.optionDisabled?F.isFunction(t.optionDisabled)?t.optionDisabled(l):F.resolveFieldData(l,t.optionDisabled):l&&l.disabled!==void 0?l.disabled:!1},i=function(l){var p=I(l);if(t.multiple){if(t.value&&t.value.length)return t.value.some(function(_){return F.equals(_,p,t.dataKey)})}else return F.equals(t.value,p,t.dataKey);return!1},c=function(){return t.options&&t.options.length?t.options.map(function(l,p){var _=t.disabled||f(l),w=z(l),R=t.disabled||p!==j?"-1":"0",B=i(l),H=w+"_"+p;return a.createElement(le,{hostName:"SelectButton",key:H,label:w,className:l.className,option:l,setFocusedIndex:g,onClick:M,template:t.itemTemplate,selected:B,tabIndex:R,index:p,disabled:_,ptm:P,cx:A,elementRef:m})}):null};a.useImperativeHandle(n,function(){return{props:t,focus:function(){return be.focusFirstElement(m.current)},getElement:function(){return m.current}}});var x=F.isNotEmpty(t.tooltip),b=c(),v=r({ref:m,id:t.id,className:K(t.className,A("root")),style:t.style,role:"group"},V.getOtherProps(t),P("root"));return a.createElement(a.Fragment,null,a.createElement("div",v,b,t.children),x&&a.createElement(Fe,J({target:m,content:t.tooltip,pt:P("tooltip")},t.tooltipOptions)))}));se.displayName="SelectButton";const et=({isEdit:e,dataToEdit:n,onSave:r,onUpdate:u,onClose:t})=>{const[C,y]=a.useState(!0),[j,g]=a.useState(null),[m,S]=a.useState(""),[P,A]=a.useState([]),[D,M]=a.useState(new Date),[z,I]=a.useState(null),[f,i]=a.useState(null),c=a.useRef(null),[x,b]=a.useState("material"),v=["Material","Material y Mano de Obra"],[h,l]=a.useState(v[0]);a.useEffect(()=>{h=="Material"&&b("material"),h=="Material y Mano de Obra"&&b("mano_obra")},[h]),a.useEffect(()=>{x=="material"?l(v[0]):l(v[1])},[x]);const[p,_]=a.useState(null),[w,R]=a.useState([]),[B,H]=a.useState("");a.useEffect(()=>{(async()=>{try{const d=await O.get(route("catalogo.list.clientes"));R(d.data)}catch{c.current.show({severity:"error",summary:"Error",detail:"No se pudo obtener la lista de clientes.",life:3e3})}})()},[]);const[$,q]=a.useState({id:3,nombre:"Peso Mexicano",abreviacion:"MXN",created_at:"2025-01-08T07:50:51.000000Z",updated_at:"2025-01-08T07:50:51.000000Z"}),[Q,ie]=a.useState([]);a.useEffect(()=>{(async()=>{try{const d=await O.get(route("catalogo.list.tiposmonedas"));ie(d.data)}catch{c.current.show({severity:"error",summary:"Error",detail:"No se pudo obtener la lista de monedas.",life:3e3})}})()},[]);const[U,Z]=a.useState({id:2,nombre:"Media",descripcion:"Prioridad Media",created_at:"2025-01-08T07:50:49.000000Z",updated_at:"2025-01-08T07:50:49.000000Z"}),[ee,ce]=a.useState([]);a.useEffect(()=>{(async()=>{try{const d=await O.get(route("catalogo.list.prioridades"));ce(d.data)}catch{c.current.show({severity:"error",summary:"Error",detail:"No se pudo obtener la lista de prioridades.",life:3e3})}})()},[]);const[X,G]=a.useState(null),[te,ue]=a.useState([]);a.useEffect(()=>{(async()=>{try{const d=await O.get(route("catalogo.list.status"));ue(d.data)}catch{c.current.show({severity:"error",summary:"Error",detail:"No se pudo obtener la lista de statuses.",life:3e3})}})()},[]),a.useEffect(()=>{(async()=>{try{const d=await O.get(route("catalogo.list.provedores"));A(d.data)}catch{c.current.show({severity:"error",summary:"Error",detail:"No se pudo obtener la lista de proveedores.",life:3e3})}})()},[]),a.useEffect(()=>{if(e&&n){S(n.titulo||""),M(new Date(n.fecha)||null),i(new Date(n.fecha_cotiza_fin)||null),I(new Date(n.fecha_cotiza_inicio)||null),b(n.es_material||"");let s;n.es_mano_obra==1?s="mano_obra":s="material",b(s),H(n.ingredient||"");const d=P.find(N=>N.id===n.provedor_id);g(d||null);const E=te.find(N=>N.id===n.status_id);G(E||null);const T=Q.find(N=>N.id===n.cat_moneda_id);q(T||null);const me=w.find(N=>N.id===n.cliente_id);_(me||null);const fe=ee.find(N=>N.id===n.cat_prioridad_id);Z(fe||null)}},[e,n,P]);const de=async()=>{if(!m||!D||!X||!$||!p||!U||!z||!f){c.current.show({severity:"warn",summary:"Campos incompletos",detail:"Todos los campos son obligatorios.",life:3e3});return}const s={status_id:X.id,moneda_id:$.id,cliente_id:p.id,prioridad_id:U.id,titulo:m,fecha:D,fecha_inicio_cotizacion:z,fecha_final_cotizacion:f,es_material:x};Se({message:e?"¿Está seguro de que desea actualizar esta cotización?":"¿Está seguro de que desea crear esta cotización?",header:e?"Confirmar Actualización":"Confirmar Creación",icon:"pi pi-exclamation-triangle",accept:async()=>{try{if(e)(await O.put(route("cotizacion.actualiza.cotizacion",{id:n.id}),s)).status===200&&(c.current.show({severity:"success",summary:"Éxito",detail:"Cotización actualizada correctamente.",life:3e3}),u());else{const E=await O.post(route("cotizacion.registrar.cotizacion"),s);console.log("Esto devuelve ---->=>",E);const{folio:T}=E.data.data;E.status===201&&(console.log("Este es el dato ",T),c.current.show({severity:"info",summary:"Cotizacion Registrada",detail:"Cotizacion con Folio '"+T+'"',life:5e3}),r())}y(!1),t()}catch{c.current.show({severity:"error",summary:"Error inesperado",detail:"No se pudo procesar la solicitud.",life:3e3})}},reject:()=>{c.current.show({severity:"info",summary:"Acción cancelada",detail:"No se realizó ningún cambio.",life:3e3})}})};return a.useEffect(()=>{setTimeout(()=>{G({id:3,nombre:"EnProcesoFaltaAlgo",abreviacion:"!",descripcion:"En Proceso O Falta Algo"})},1e3),setTimeout(()=>{Z({id:4,nombre:"Baja",descripcion:"Puede atenderse después de las prioridades más altas"})},1100),setTimeout(()=>{q({id:3,nombre:"Peso Mexicano",abreviacion:"MXN"})},1200)},[]),o.jsxs(o.Fragment,{children:[o.jsx(xe,{}),o.jsxs(he,{header:e?"Detalle Cotización":"Nueva Cotización",visible:C,maximizable:!0,style:{width:"80vw"},onHide:()=>{y(!1),t()},children:[o.jsx(ge,{ref:c}),o.jsxs("div",{className:"grid my-5",children:[o.jsxs("div",{className:"col-6 md:col-12 mb-3",children:[o.jsx("label",{htmlFor:"titulo",children:"Título"}),o.jsx(k,{children:o.jsx(ye,{id:"titulo",value:m,onChange:s=>S(s.target.value),className:"w-full"})})]}),o.jsxs("div",{className:"col-6 md:col-12 mb-3",children:[o.jsx("label",{htmlFor:"Cliente",children:"Cliente"}),o.jsx(L,{className:"mb-3 col-12",value:p,onChange:s=>_(s.value),options:w,optionLabel:"nombre",placeholder:"Seleccione un Cliente",filter:!0,filterBy:"nombre",showClear:!0})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4 items-start",children:[o.jsx("div",{className:"col-span-1 m-4",children:o.jsxs(k,{children:[o.jsx(W,{id:"fecha",value:D,onChange:s=>M(s.value),className:"w-full",showIcon:!0,dateFormat:"dd/mm/yy"}),o.jsx("label",{htmlFor:"fecha",children:"Fecha"})]})}),o.jsxs("div",{className:"col-span-1",children:[o.jsx("label",{htmlFor:"selectPlantilla",className:"m-3",children:"Selecciona la plantilla"}),o.jsx(se,{value:h,onChange:s=>l(s.value),options:v})]})]}),o.jsx(_e,{}),o.jsx(we,{legend:"Periodo de Validez",className:"col-12",children:o.jsxs("div",{className:"flex flex-wrap gap-3",children:[o.jsx("div",{className:"col-4 md:col-4",children:o.jsxs(k,{children:[o.jsx(W,{id:"fecha_inicio_cotizacion",value:z,onChange:s=>I(s.value),className:"w-full",showIcon:!0,dateFormat:"dd/mm/yy"}),o.jsx("label",{htmlFor:"fecha_inicio_cotizacion",children:"Fecha inicio Cotizacion"})]})}),o.jsx("div",{className:"col-4 md:col-4",children:o.jsxs(k,{children:[o.jsx(W,{id:"fecha_fin_cotizacion",value:f,onChange:s=>i(s.value),className:"w-full",showIcon:!0,dateFormat:"dd/mm/yy"}),o.jsx("label",{htmlFor:"fecha_fin_cotizacion",children:"Fecha fin Cotizacion"})]})})]})}),o.jsxs("div",{className:"col-4",children:[o.jsx("label",{htmlFor:"proveedor",children:"Status"}),o.jsx(L,{className:"mb-3 col-12",value:X,onChange:s=>G(s.value),options:te,optionLabel:"descripcion",placeholder:"Seleccione un status",filter:!0,filterBy:"nombre",showClear:!0})]}),o.jsxs("div",{className:"col-4",children:[o.jsx("label",{htmlFor:"prioridad",children:"Prioridad"}),o.jsx(L,{className:"mb-3 col-12",value:U,onChange:s=>Z(s.value),options:ee,optionLabel:"nombre",placeholder:"Seleccione un Prioridad",filter:!0,filterBy:"nombre",showClear:!0})]}),o.jsxs("div",{className:"col-4",children:[o.jsx("label",{htmlFor:"Moneda",children:"Moneda"}),o.jsx(L,{className:"mb-3 col-12",value:$,onChange:s=>q(s.value),options:Q,optionLabel:"nombre",placeholder:"Seleccione una Moneda",filter:!0,filterBy:"nombre",showClear:!0})]}),o.jsx("div",{className:"col-12",children:o.jsx(ve,{label:e?"Actualizar":"Guardar",onClick:de,className:"p-button-success"})})]})]})]})};export{et as default};
