{"version":3,"file":"BusquedaActividad-01dba10b.js","sources":["../../../resources/js/Pages/Actividades/Partials/BusquedaActividad.jsx"],"sourcesContent":["import React, { useEffect, useState, forwardRef, useImperativeHandle} from 'react';\nimport { Dropdown } from 'primereact/dropdown';\nimport { Calendar } from 'primereact/calendar';\nimport { Button } from 'primereact/button';\n\n\n\n// const BusquedaActividad = forwardRef(({ resultadoBusqueda, setLastPageUrl, setNextPageUrl, setTotalRegistros, setPaginaActual , setRegistros}, ref) => {\nconst BusquedaActividad = forwardRef(({setRegistros, setPaginaActual, setPerPage, setTotal }, ref) => {\n    const [usuarios, setUsuarios] = useState([]);\n    const [date1, setDate1] = useState(new Date());\n    const [date2, setDate2] = useState(new Date());\n    const [loading, setLoading] = useState(false);\n\n    const [filtros, setFiltros] = useState({\n        selectPersona: { name: \"Todos\", code: \"*\" },\n        fecha1: new Date().toISOString().slice(0, 10),\n        fecha2: new Date().toISOString().slice(0, 10),\n        selectedPrioridad: null,\n        selectedStatus: null,\n    });\n\n    // Formulario\n    const [selectPersona, setSelectPersona] = useState({name: \"Todos\", code: \"*\"});\n    const [fecha1, setFecha1] = useState(null)\n    const [fecha2, setFecha2] = useState(null)\n    const [selectedPrioridad, setSelectedPrioridad] = useState({name: 'Todas', code:'*'},);\n    const [selectedStatus, setSelectedStatus] = useState({name:'Todos', code:'*'},);\n    // --------------------\n    useEffect(()=>{\n        obtenerCatUsuarios()\n        definirFechas()\n        setTimeout(async() => {\n            const datos = {\n                page: 1,\n                selectPersona: selectPersona,\n                fecha1: (fecha1===null)? new Date().toISOString().slice(0, 10) : fecha1,\n                fecha2: (fecha2===null)? new Date().toISOString().slice(0, 10) : fecha2,\n                selectedPrioridad: selectedPrioridad,\n                selectedStatus: selectedStatus,\n            }       \n            await consultar(datos) \n        }, 1000);\n    },[])\n\n\n    const definirFechas = () => {\n        setFecha1(new Date())\n        setFecha2(new Date())\n    }\n\n    \n    useEffect(()=>{\n        if(date1){\n            let fechaFormato1 = date1 ? date1.toISOString().slice(0, 10) : null;\n            setFecha1(fechaFormato1)\n        }\n        if(date2){\n            let fechaFormato2 = date2 ? date2.toISOString().slice(0, 10) : null;\n            setFecha2(fechaFormato2)\n        }\n    },[date1, date2]);\n\n    const obtenerCatUsuarios = async () =>{\n        try {\n            setTimeout( async() => {\n                const response = await axios.get(route(\"listado.catalogos.detalle.usuarios\"));     \n                const {data,status }= response\n                if(status == 200){\n                  const listadoUsuarios = [\n                        { name: \"Todos\", code: \"*\" },\n                        ...data.map(item => ({\n                            code: item.id,\n                            name: item.name,\n                        }))\n                    ];\n                    setUsuarios(listadoUsuarios)\n                }                \n            }, 800);  \n        } catch (error) {\n            toast.current.show({\n                severity: \"error\",\n                summary: \"Error\",\n                detail: \"No se logro cargar el Catalogo de Clientes\",\n                life: 3000,\n            });\n        }\n    }\n    const status = [\n        {name:'Todos', code:'*'},\n        {name:'Pendiente', code:'Pendiente'},\n        {name:'Realizado', code:'Realizado'},\n    ];\n    const prioridad = [\n        {name: 'Todas', code:'*'},\n        {name: 'Baja', code:'Baja'},\n        {name: 'Media', code:'Media'},\n        {name: 'Alta', code:'Alta'},\n    ];\n\n    const handleSubmit = async (e) => {\n        e.preventDefault(); // Evita que el formulario recargue la página  \n        const nuevosFiltros = {\n            selectPersona,\n            fecha1,\n            fecha2,\n            selectedPrioridad,\n            selectedStatus,\n        };\n\n        // Guardar filtros sin página (la agregaremos luego)\n        setFiltros(nuevosFiltros);\n        await consultar({ ...nuevosFiltros, page: 1 });\n    };\n\n    const consultar = async (datos) =>{\n        setLoading(true)\n        try {\n\n            const response = await axios.get(route(\"busqueda.actividades\"), {params: datos});\n            console.log(\"Esto es\", response);\n            \n            const {status} = response\n            if (status === 200) {\n                const {\n                    data, \n                    current_page,// PAgina actual\n                    per_page, // por pagina\n                    total, // total de registros\n                } = response.data;\n                setRegistros(data)\n                setPaginaActual(current_page)\n                setPerPage(per_page)\n                setTotal(total)\n                setLoading(false)\n            }\n                            \n        } catch (error) {\n            console.error(error);\n            setLoading(false)\n            alert(\"Error\")\n                \n        }\n    }\n\n    useImperativeHandle(ref, () => ({\n        reloadListado(pagina = 1) {\n            // Combina filtros actuales + nueva página\n            const filtrosConPagina = {\n                ...filtros,\n                page: pagina\n            };\n            // console.log(\"Estos son los filtros\",filtrosConPagina);\n            \n            consultar(filtrosConPagina);\n        }\n    }));\n\n    return (\n        <div className=\"card\">\n            <form action=\"\" onSubmit={handleSubmit}>\n                <div className=\"flex flex-wrap gap-3 mb-4\">\n                    <div className=\"flex-auto min-w-[250px]\">\n                        <label htmlFor=\"usuario\" className=\"font-bold block mb-2\">Usuario</label>\n                        <Dropdown\n                            inputId=\"usuario\"\n                            value={selectPersona}\n                            onChange={(e) => setSelectPersona(e.value)}\n                            options={usuarios}\n                            optionLabel=\"name\"\n                            placeholder=\"Selecciona Usuario\"\n                            className=\"w-full\"\n                        />\n                    </div>\n                    <div className=\"flex-auto min-w-[250px]\">\n                        <label htmlFor=\"estatus\" className=\"font-bold block mb-2\">Estatus</label>                        \n                        <Dropdown\n                            inputId=\"prioridad\"\n                            value={selectedStatus}\n                            onChange={(e) => setSelectedStatus(e.value)}\n                            options={status}\n                            optionLabel=\"name\"\n                            placeholder=\"Selecciona Estatus\"\n                            className=\"w-full\"\n                        />\n                    </div>\n                    <div className=\"flex-auto min-w-[250px]\">\n                        <label htmlFor=\"prioridad\" className=\"font-bold block mb-2\">Prioridad</label>\n                        <Dropdown\n                            inputId=\"estatus\"\n                            value={selectedPrioridad}\n                            onChange={(e) => setSelectedPrioridad(e.value)}\n                            options={prioridad}\n                            optionLabel=\"name\"\n                            placeholder=\"Selecciona Prioridad\"\n                            className=\"w-full\"\n                        />\n                    </div>\n                  \n                </div>\n                <div className=\"flex flex-wrap gap-3 mb-4\">\n                    <div className=\"flex-auto min-w-[250px]\">\n                        <label htmlFor=\"fechainicio\" className=\"font-bold block mb-2\">Fecha inicio</label>\n                        <Calendar\n                            inputId=\"fechainicio\"\n                            value={date1}\n                            onChange={(e) => setDate1(e.value)}\n                            dateFormat=\"dd/mm/yy\"\n                            className=\"w-full\"\n                            showIcon\n                        />\n                    </div>\n                    <div className=\"flex-auto min-w-[250px]\">\n                        <label htmlFor=\"fechafin\" className=\"font-bold block mb-2\">Fecha fin</label>\n                        <Calendar\n                            inputId=\"fechafin\"\n                            value={date2}\n                            onChange={(e) => setDate2(e.value)}\n                            dateFormat=\"dd/mm/yy\"\n                            className=\"w-full\"\n                            showIcon\n                        />\n                    </div>\n                    <div className=\"min-w-[250px]  items-end p-4\">\n                        <Button label=\"Buscar\" loading={loading}/>\n                    </div>\n                </div>\n            </form>            \n        </div>\n    );\n});\n\nexport default BusquedaActividad;\n"],"names":["BusquedaActividad","forwardRef","setRegistros","setPaginaActual","setPerPage","setTotal","ref","usuarios","setUsuarios","useState","date1","setDate1","date2","setDate2","loading","setLoading","filtros","setFiltros","selectPersona","setSelectPersona","fecha1","setFecha1","fecha2","setFecha2","selectedPrioridad","setSelectedPrioridad","selectedStatus","setSelectedStatus","useEffect","obtenerCatUsuarios","definirFechas","datos","consultar","fechaFormato1","fechaFormato2","response","data","status","listadoUsuarios","item","prioridad","handleSubmit","nuevosFiltros","current_page","per_page","total","error","useImperativeHandle","pagina","filtrosConPagina","jsx","jsxs","Dropdown","Calendar","Button"],"mappings":"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"}