{"version":3,"file":"BuscadorCotizacion-94e19873.js","sources":["../../../resources/js/Pages/Actividades/Partials/BuscadorCotizacion.jsx"],"sourcesContent":["import React, { Component, useState, useRef, useEffect } from \"react\";\nimport { Card } from 'primereact/card';\nimport { Button } from 'primereact/button';\nimport { Dialog } from 'primereact/dialog';\nimport { InputText } from 'primereact/inputtext';\nimport { Calendar } from 'primereact/calendar';\nimport { DataTable } from 'primereact/datatable';\nimport { Column } from 'primereact/column';\nimport { SelectButton } from 'primereact/selectbutton';\nimport { Toast } from 'primereact/toast';\n\n\nconst BuscadorCotizacion = ({preguntaBusquedaCotizaciones,setPreguntaBusquedaCotizaciones, identyAsociaActividad, setIdentyAsociaActividad, recargar}) => {\n    const toast = useRef(null);\n    const [visible, setVisible] = useState(false);\n    const [loading, setLoading] = useState(false);\n\n    const [cotizacion, setCotizacion] = useState('');\n    const [titulo, setTitulo] = useState('');\n    const [fecha, setFecha] = useState(null);\n\n    const [cotizaciones, setCotizaciones] = useState([]);\n    const [actividadAsc, setActividadAsc] = useState(null);\n    \n\n    useEffect(()=>{\n        if (preguntaBusquedaCotizaciones) {\n            setVisible(preguntaBusquedaCotizaciones)\n            setActividadAsc(identyAsociaActividad)\n        }\n\n    },[preguntaBusquedaCotizaciones,identyAsociaActividad])\n\n \n\n    useEffect(()=>{\n        if(visible===false){\n            setPreguntaBusquedaCotizaciones(visible)\n            limpiarFormulario()\n        }\n    },[visible])\n\n    const limpiarFormulario = () =>{\n        setCotizacion('')\n        setTitulo('')\n        setFecha(null)\n        setCotizaciones([])\n        setActividadAsc(null)\n    }\n\n    const validarDatos = ({ cotizacion, titulo, fecha }) => {\n        const algunoTieneValor =\n            (cotizacion && cotizacion.trim() !== '') ||\n            (titulo && titulo.trim() !== '') ||\n            fecha;\n\n        if (!algunoTieneValor) {\n            return \"Debes ingresar al menos uno de los siguientes campos: Cotización, Título o Fecha.\";\n        }\n\n        return null; // ✅ Todo correcto\n    };\n    const handleSubmit = async (e) =>{\n        \n        e.preventDefault();\n        setLoading(true)\n\n        const datos = {\n            cotizacion: cotizacion,\n            titulo:titulo,\n            fecha: fecha,\n        }\n\n        const error = validarDatos(datos);\n\n        if (error) {\n            setLoading(false)\n            toast.current.show({\n                severity: \"error\",\n                summary: \"Error\",\n                detail: error,\n                life: 3000,\n            });\n            return;\n        }\n        consultar(datos)        \n    }\n\n\n    const consultar = async (datos) =>{\n        try {\n            const response = await axios.get(route(\"busqueda.actividades.cotizacion\"), {params: datos});\n            \n            \n            const {status, data} = response\n            if (status === 200) {\n                if(data.length == 0){\n                    toast.current.show({severity:'info', summary: 'Info', detail:'No se encontraron suficientes registros', life: 5000});\n                }\n                setCotizaciones(data)\n                setLoading(false)\n            }\n                            \n        } catch (error) {\n            setLoading(false)\n            alert(\"Error\")                \n        }\n    }\n\n    const accionesTemplate = (rowData) => {\n        \n        return (\n            <div className=\"flex gap-2\">                 \n                <Button\n                    label=\"Ver\"\n                    size=\"small\"\n                    icon=\"pi pi-eye\"\n                    className=\"p-button-sm p-button-info\"\n                    rounded\n                    onClick={() => handleVer(rowData)}\n                />\n                <Button\n                    label=\"Asociar\"\n                    size=\"small\"\n                    icon=\"pi pi-link\"\n                    className=\"p-button-sm p-button-secondary\"\n                    rounded\n                    onClick={() => handleAsociarActividadCotizacion(rowData)}\n                />                \n            </div>\n        );\n    };\n\n    const handleVer = (rowData) =>{\n        const url = route('cotizacion.captura.detalle', rowData.id);\n        window.open(url, '_blank');\n    }\n\n    const handleAsociarActividadCotizacion = async(rowData)=>{\n        try {\n            const datos = {\n            id_cotizacion: rowData.id,\n            id_actividad:actividadAsc,\n        }\n            const response = await axios.post(route(\"asociar.cotizacion.actividad\"), datos);            \n            const { data, status} = response\n\n            if (status === 201) {\n                toast.current.show({\n                    severity: \"success\",\n                    summary: \"Success\",\n                    detail: `${data.success}`,\n                    life: 3000,\n                });\n                limpiarFormulario()\n                setIdentyAsociaActividad(null)\n                recargar(1)       \n                setVisible(false)    \n                setLoading(false)   \n                setPreguntaBusquedaCotizaciones(false)\n            }\n        } \n        catch (error) {\n            \n            setLoading(false)\n            toast.current.show({\n                severity: \"error\",\n                summary: \"Error\",\n                detail: \"Error al asociar Actividad con la cotizacion\",\n                life: 3000,\n            });\n        }\n        \n        \n    }\n\n\n    return (    \n        <div className=\"flex justify-content-center\">\n            <Dialog header=\"Asociar de Tarea y Cotización\" visible={visible} maximizable style={{ width: '50vw' }} onHide={() => {if (!visible) return; setVisible(false); }}>\n                <form onSubmit={handleSubmit}>\n                    <div className=\"flex flex-wrap gap-3 mb-4\">\n                        {/* Cotización */}\n                        <div className=\"flex-auto min-w-[250px]\">\n                            <label htmlFor=\"cotizacion\" className=\"font-bold block mb-2\">Cotización</label>\n                            <InputText\n                                id=\"cotizacion\"\n                                value={cotizacion}\n                                onChange={(e) => setCotizacion(e.target.value)}\n                                placeholder=\"Número o código de cotización\"\n                                className=\"w-full\"\n                            />\n                        </div>\n\n                        {/* Título */}\n                        <div className=\"flex-auto min-w-[250px]\">\n                            <label htmlFor=\"titulo\" className=\"font-bold block mb-2\">Título</label>\n                            <InputText\n                                id=\"titulo\"\n                                value={titulo}\n                                onChange={(e) => setTitulo(e.target.value)}\n                                placeholder=\"Escribe el título\"\n                                className=\"w-full\"\n                            />\n                        </div>\n\n                        {/* Fecha */}\n                        <div className=\"flex-auto min-w-[250px]\">\n                            <label htmlFor=\"fecha\" className=\"font-bold block mb-2\">Fecha</label>\n                            <Calendar\n                                id=\"fecha\"\n                                value={fecha}\n                                onChange={(e) => setFecha(e.value)}\n                                dateFormat=\"dd/mm/yy\"\n                                placeholder=\"Selecciona fecha\"\n                                className=\"w-full\"\n                                showIcon\n                            />\n                        </div>\n                        <div className=\"flex justify-content-center\">\n                            <Button label=\"Buscar\" type=\"submit\" size=\"small\" loading={loading}/>\n                        </div>              \n                    </div>  \n                </form>\n                <DataTable value={cotizaciones} size={'small'} tableStyle={{ minWidth: '50rem' }}>\n                    <Column field=\"folio\" header=\"Folio\"></Column>\n                    <Column field=\"titulo\" header=\"Titulo\"></Column>\n                    <Column field=\"fecha\" header=\"Fecha\"></Column>\n                    <Column header=\"Acciones\" body={accionesTemplate} style={{ width: '150px' }} />\n                </DataTable>\n            </Dialog>\n            <Toast ref={toast} />\n        </div>\n    );\n};\n\nexport default BuscadorCotizacion;"],"names":["BuscadorCotizacion","preguntaBusquedaCotizaciones","setPreguntaBusquedaCotizaciones","identyAsociaActividad","setIdentyAsociaActividad","recargar","toast","useRef","visible","setVisible","useState","loading","setLoading","cotizacion","setCotizacion","titulo","setTitulo","fecha","setFecha","cotizaciones","setCotizaciones","actividadAsc","setActividadAsc","useEffect","limpiarFormulario","validarDatos","handleSubmit","e","datos","error","consultar","response","status","data","accionesTemplate","rowData","jsxs","jsx","Button","handleVer","handleAsociarActividadCotizacion","url","Dialog","InputText","Calendar","DataTable","Column","Toast"],"mappings":"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"}