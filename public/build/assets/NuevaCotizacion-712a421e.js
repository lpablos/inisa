import{r as o,j as a}from"./app-19db06cb.js";import{F as oe}from"./fieldset.esm-7b191b33.js";import{I as te}from"./inputtext.esm-06be2f11.js";import{C as x}from"./calendar.esm-94497439.js";import{D as ie}from"./dialog.esm-18943087.js";import{B as le}from"./button.esm-8dbecc90.js";import{D as n}from"./dropdown.esm-5f54d0b4.js";import{T as re}from"./toast.esm-0ed1f3f5.js";import{D as ne}from"./divider.esm-09bb4f3c.js";import"./iconbase.esm-8ede90bc.js";import"./csstransition.esm-dcf34adf.js";import"./index.esm-fe6507a8.js";import"./ripple.esm-586a3f44.js";import"./tooltip.esm-01d8262e.js";import"./overlayservice.esm-1e88b1a3.js";import"./index.esm-87540949.js";import"./index.esm-19bb07b4.js";import"./index.esm-a014419b.js";import"./index.esm-e985f2f4.js";import"./virtualscroller.esm-3b43f60c.js";import"./index.esm-2b3c0470.js";const Ie=({preguntaNuevaCotizacion:h,setPreguntaNuevaCotizacion:P,identyNewCotizacion:y,recargar:M})=>{const i=o.useRef(null),[l,p]=o.useState(!1),[A,r]=o.useState(!1),[L,j]=o.useState(null),[N,g]=o.useState(""),[c,w]=o.useState(null),[S,F]=o.useState(null),[d,_]=o.useState(null),[E,C]=o.useState(null),[z,D]=o.useState(null),[u,I]=o.useState(null),[m,$]=o.useState(null),[f,k]=o.useState(null),[V,T]=o.useState([]),[G,ce]=o.useState([{name:"Material",code:"material"},{name:"Material y Mano de Obra",code:"mano_obra"}]),[O,B]=o.useState([]),[R,q]=o.useState([]),[H,J]=o.useState([]);o.useEffect(()=>{h===!0&&p(h)},[h]),o.useEffect(()=>{l===!1&&P(l)},[l]),o.useEffect(()=>{j(y)},[y]);function K(e){return!e.titulo||e.titulo.trim()===""?"El título es obligatorio.":e.cliente_id?e.fecha?e.es_material?e.status_id?e.prioridad_id?e.moneda_id?e.fecha_inicio_cotizacion?e.fecha_final_cotizacion?null:"Debes seleccionar una Fin Vigencia.":"Debes seleccionar una Inicio Vigencia":"Selecciona una moneda.":"Debes seleccionar una prioridad.":"Debes seleccionar un estatus.":"Selecciona la plantilla.":"Debes seleccionar una fecha.":"Debes seleccionar un cliente."}const Q=async e=>{e.preventDefault(),r(!0);const t={status_id:(u==null?void 0:u.id)??null,moneda_id:(f==null?void 0:f.id)??null,cliente_id:(c==null?void 0:c.id)??null,prioridad_id:(m==null?void 0:m.id)??null,titulo:N??null,fecha:S??null,fecha_inicio_cotizacion:E??null,fecha_final_cotizacion:z??null,es_material:(d==null?void 0:d.code)??null},s=K(t);if(s){r(!1),i.current.show({severity:"error",summary:"Error",detail:s,life:3e3});return}U(t)},U=async e=>{try{const t=await axios.post(route("cotizacion.registrar.cotizacion"),e),{data:s,status:b}=t,{folio:v}=s.data;b===201&&(i.current.show({severity:"success",summary:"Success",detail:`${s.success}`,life:3e3}),i.current.show({severity:"info",summary:"Info",detail:`Folio Generado : ${v}`,life:5e3}),W(s.data))}catch(t){console.error(t),r(!1),i.current.show({severity:"error",summary:"Error",detail:"Error al registrar la cotizacion",life:3e3}),r(!1)}},W=async e=>{const{id:t}=e;try{const s={cotizacion_id:t,actividad_id:L},b=await axios.post(route("asociar.activid.cotizacion"),s),{data:v,status:se}=b;se===201&&(i.current.show({severity:"success",summary:"Success",detail:`${v.success}`,life:3e3}),r(!1),X(),p(!1),j(null),M(1))}catch(s){console.error(s),r(!1),i.current.show({severity:"error",summary:"Error",detail:"Error al asociar Actividad con la cotizacion",life:3e3})}},X=()=>{I(null),k(null),w(null),$(null),g(""),F(null),C(null),D(null),_(null)},Y=async()=>{try{const t=(await axios.get(route("catalogo.list.status"))).data.map(s=>({id:s.id,name:`(${s.abreviacion}) - ${s.descripcion}`,code:s.id}));B(t)}catch{i.current.show({severity:"error",summary:"Error",detail:"No se pudo obtener la lista de prioridades.",life:3e3})}},Z=async()=>{try{const t=(await axios.get(route("catalogo.list.prioridades"))).data.map(s=>({id:s.id,name:`${s.nombre}`,code:s.id}));q(t)}catch{i.current.show({severity:"error",summary:"Error",detail:"No se pudo obtener la lista de statuses.",life:3e3})}},ee=async()=>{try{const t=(await axios.get(route("catalogo.list.tiposmonedas"))).data.map(s=>({id:s.id,name:`${s.abreviacion} - ${s.nombre}`,code:s.abreviacion}));J(t)}catch{i.current.show({severity:"error",summary:"Error",detail:"No se pudo obtener la lista de monedas.",life:3e3})}},ae=async()=>{try{const t=(await axios.get(route("catalogo.list.clientes"))).data.map(s=>({id:s.id,name:`${s.abreviacion} - ${s.nombre}`,code:s.nombre}));T(t)}catch{i.current.show({severity:"error",summary:"Error",detail:"No se pudo obtener la lista de clientes.",life:3e3})}};return o.useEffect(()=>{Y(),Z(),ee(),ae()},[l]),a.jsxs("div",{className:"flex justify-content-center",children:[a.jsx(re,{ref:i}),a.jsxs(ie,{header:"Cotización Generada a Partir de una Actividad",visible:l,maximizable:!0,style:{width:"50vw"},onHide:()=>{l&&p(!1)},children:[a.jsx("p",{className:"m-0 mb-4 font-bold text-center",children:"Nota: Esta cotización quedará relacionada con la actividad en curso."}),a.jsxs("form",{action:"",onSubmit:Q,children:[a.jsxs(oe,{legend:"Datos Generales de Cotización",children:[a.jsxs("div",{className:"formgrid grid p-fluid",children:[a.jsxs("div",{className:"field col-12",children:[a.jsx("label",{htmlFor:"titulo",className:"font-bold block mb-2",children:"Título"}),a.jsx(te,{id:"titulo",value:N,onChange:e=>g(e.target.value)})]}),a.jsxs("div",{className:"field col-12",children:[a.jsx("label",{htmlFor:"cliente",className:"font-bold block mb-2",children:"Cliente"}),a.jsx(n,{id:"cliente",value:c,onChange:e=>w(e.value),options:V,optionLabel:"name",placeholder:"Selecciona un cliente",className:"w-full"})]}),a.jsxs("div",{className:"field col-6",children:[a.jsx("label",{htmlFor:"fecha",className:"font-bold block mb-2",children:"Fecha"}),a.jsx(x,{id:"fecha",value:S,onChange:e=>F(e.value),dateFormat:"dd/mm/yy",showIcon:!0,className:"w-full"})]}),a.jsxs("div",{className:"field col-6",children:[a.jsx("label",{htmlFor:"plantilla",className:"font-bold block mb-2",children:"Plantilla"}),a.jsx(n,{id:"plantilla",value:d,onChange:e=>_(e.value),options:G,optionLabel:"name",placeholder:"Selecciona una plantilla",className:"w-full"})]})]}),a.jsxs("div",{className:"formgrid grid p-fluid",children:[a.jsxs("div",{className:"field col-4",children:[a.jsx("label",{htmlFor:"estatus",className:"font-bold block mb-2",children:"Estatus"}),a.jsx(n,{id:"estatus",value:u,onChange:e=>I(e.value),options:O,optionLabel:"name",placeholder:"Selecciona un estatus",className:"w-full"})]}),a.jsxs("div",{className:"field col-4",children:[a.jsx("label",{htmlFor:"prioridad",className:"font-bold block mb-2",children:"Prioridad"}),a.jsx(n,{id:"prioridad",value:m,onChange:e=>$(e.value),options:R,optionLabel:"name",placeholder:"Selecciona una prioridad",className:"w-full"})]}),a.jsxs("div",{className:"field col-4",children:[a.jsx("label",{htmlFor:"moneda",className:"font-bold block mb-2",children:"Moneda"}),a.jsx(n,{id:"moneda",value:f,onChange:e=>k(e.value),options:H,optionLabel:"name",placeholder:"Selecciona una moneda",className:"w-full"})]})]}),a.jsx(ne,{}),a.jsx("h5",{className:"mt-3",children:"Periodo de Validez"}),a.jsxs("div",{className:"formgrid grid p-fluid",children:[a.jsxs("div",{className:"field col-4",children:[a.jsx("label",{htmlFor:"fechaInicio",className:"font-bold block mb-2",children:"Inicio Vigencia"}),a.jsx(x,{id:"fechaInicio",value:E,onChange:e=>C(e.value),dateFormat:"dd/mm/yy",showIcon:!0,className:"w-full"})]}),a.jsxs("div",{className:"field col-4",children:[a.jsx("label",{htmlFor:"fechaFin",className:"font-bold block mb-2",children:"Fin Vigencia"}),a.jsx(x,{id:"fechaFin",value:z,onChange:e=>D(e.value),dateFormat:"dd/mm/yy",showIcon:!0,className:"w-full"})]})]})]}),a.jsx("div",{className:"flex justify-content-center",children:a.jsx(le,{label:"Generar",type:"submit",size:"small",loading:A})})]})]})]})};export{Ie as default};
//# sourceMappingURL=NuevaCotizacion-712a421e.js.map
